<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="FF14-‰ªô‰∫∫ÂæÆÂΩ©">
    
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <title>FF14-‰ªô‰∫∫ÂæÆÂΩ©</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&display=swap" rel="stylesheet">

    <style>
        /* --- Ê†∏ÂøÉÊ®£ÂºèË®≠ÂÆö --- */
        :root {
            --gold-primary: #d4af37;
            --gold-light: #fcd34d;
            --gold-dark: #927215;
            --casino-red: #4a0404;
            --casino-black: #0f0f11;
        }

        body { 
            -webkit-tap-highlight-color: transparent; 
            font-family: "Segoe UI", "Microsoft JhengHei", sans-serif; 
            background-color: var(--casino-black);
            background-image: radial-gradient(circle at center top, #7f1d1d 0%, var(--casino-red) 40%, #000000 100%);
            background-size: 100% 100%;
            background-attachment: fixed;
            overscroll-behavior-y: none;
            color: #fff;
        }
        
        .font-game { font-family: 'Cinzel', serif; }

        .casino-pattern {
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 0l15 30-15 30-15-30z' fill='%23d4af37' fill-opacity='0.05'/%3E%3C/svg%3E");
            background-size: 60px 60px;
            opacity: 0.3;
            mix-blend-mode: overlay;
        }

        .select-none { user-select: none; -webkit-user-select: none; }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--casino-red); }
        ::-webkit-scrollbar-thumb { background: linear-gradient(to bottom, var(--gold-primary), var(--gold-dark)); border-radius: 3px; }

        /* --- UI ÂÖÉ‰ª∂Ê®£Âºè --- */

        .btn-3d {
            transition: all 0.1s;
            box-shadow: 0px 6px 0px 0px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.2);
            border-bottom: none;
        }
        .btn-3d:active {
            transform: translateY(6px);
            box-shadow: 0px 0px 0px 0px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.1);
        }
        
        .text-gold {
            background: linear-gradient(to bottom, var(--gold-light), var(--gold-primary), var(--gold-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0px 2px 2px rgba(0,0,0,0.8));
        }

        .casino-panel {
            background: linear-gradient(135deg, rgba(74, 4, 4, 0.8), rgba(15, 15, 17, 0.9));
            backdrop-filter: blur(8px);
            border: 2px solid var(--gold-primary);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5), inset 0 0 20px rgba(212, 175, 55, 0.1);
            position: relative;
        }
        .casino-panel::after {
            content: ''; position: absolute; inset: -4px; border: 1px solid var(--gold-light); border-radius: inherit; opacity: 0.3; pointer-events: none;
        }

        .circle-cell {
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #4a0404, #000);
            border: 3px solid var(--gold-primary);
            box-shadow: inset 0 0 20px rgba(0,0,0,1), 0 4px 10px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
            touch-action: manipulation;
        }
        .circle-cell.filled {
            background: radial-gradient(circle at 30% 30%, var(--gold-light), var(--gold-primary), #b45309);
            border-color: var(--gold-light);
            color: #451a03;
            text-shadow: 0 1px 0 rgba(255,255,255,0.4);
            box-shadow: inset 0 0 10px rgba(255,255,0,0.5), 0 0 20px rgba(212, 175, 55, 0.6);
        }
        @keyframes rainbow-pulse {
            0% { box-shadow: 0 0 20px rgba(255,0,0,0.8), 0 0 40px rgba(255,165,0,0.5); }
            25% { box-shadow: 0 0 20px rgba(255,255,0,0.8), 0 0 40px rgba(0,255,0,0.5); }
            50% { box-shadow: 0 0 20px rgba(0,255,255,0.8), 0 0 40px rgba(0,0,255,0.5); }
            75% { box-shadow: 0 0 20px rgba(128,0,128,0.8), 0 0 40px rgba(255,0,255,0.5); }
            100% { box-shadow: 0 0 20px rgba(255,0,0,0.8), 0 0 40px rgba(255,165,0,0.5); }
        }
        .circle-cell.suggested {
            border-color: #fff;
            animation: rainbow-pulse 3s linear infinite;
            z-index: 10;
        }

    </style>
</head>
<body class="min-h-screen relative overflow-x-hidden font-sans">

    <div class="fixed inset-0 casino-pattern pointer-events-none z-0"></div>

    <div id="root" class="relative z-10"></div>

    <script type="text/babel">
        // ‚òÖ‚òÖ‚òÖ Êõ¥Êñ∞ÊôÇÈñì ‚òÖ‚òÖ‚òÖ
        const BUILD_TIMESTAMP = "2025/12/12 02:55"; 

        const { useState, useEffect, useMemo, useRef, useCallback } = React;

        // --- Èü≥ÊïàÊéßÂà∂Âô® (Sound Controller - V3 Fixed) ---
        const useSound = (enabled) => {
            const audioCtxRef = useRef(null);

            // 1. ÂàùÂßãÂåñ AudioContext (‰ΩÜÂÖà‰∏çÂïüÂãïÔºåÁ≠âÂæÖ‰ΩøÁî®ËÄÖ‰∫íÂãï)
            const initAudio = () => {
                if (!audioCtxRef.current) {
                    const Ctx = window.AudioContext || window.webkitAudioContext;
                    if (Ctx) audioCtxRef.current = new Ctx();
                }
            };

            // 2. Ëß£ÈéñÈü≥Êïà (Âú®‰ΩøÁî®ËÄÖÈªûÊìäÈ†ÅÈù¢‰ªª‰ΩïÂú∞ÊñπÊôÇËß∏Áôº)
            const unlockAudio = useCallback(() => {
                if (audioCtxRef.current && audioCtxRef.current.state === 'suspended') {
                    audioCtxRef.current.resume().then(() => {
                        console.log("AudioContext unlocked");
                    }).catch(e => console.error(e));
                }
            }, []);

            // Áõ£ËÅΩÂÖ®ÂüüÈªûÊìä‰æÜËß£ÈéñÈü≥Êïà
            useEffect(() => {
                initAudio();
                const handleUnlock = () => {
                    unlockAudio();
                    // Âè™Ë¶ÅËß£Èéñ‰∏ÄÊ¨°Âç≥ÂèØÔºåÁßªÈô§Áõ£ËÅΩ
                    window.removeEventListener('click', handleUnlock);
                    window.removeEventListener('touchstart', handleUnlock);
                };
                window.addEventListener('click', handleUnlock);
                window.addEventListener('touchstart', handleUnlock);
                return () => {
                    window.removeEventListener('click', handleUnlock);
                    window.removeEventListener('touchstart', handleUnlock);
                };
            }, [unlockAudio]);

            const playTone = useCallback((freq, type, duration, vol = 0.1, startTime = 0) => {
                if (!enabled) return;
                try {
                    // Á¢∫‰øù Context Â≠òÂú®
                    if (!audioCtxRef.current) initAudio();
                    const ctx = audioCtxRef.current;
                    if (!ctx) return;

                    // ÂÜçÊ¨°ÂòóË©¶ resume (ÈõôÈáç‰øùÈö™)
                    if (ctx.state === 'suspended') ctx.resume();

                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();

                    osc.type = type;
                    osc.frequency.setValueAtTime(freq, ctx.currentTime + startTime);
                    
                    gain.gain.setValueAtTime(vol, ctx.currentTime + startTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + startTime + duration);

                    osc.connect(gain);
                    gain.connect(ctx.destination);

                    osc.start(ctx.currentTime + startTime);
                    osc.stop(ctx.currentTime + startTime + duration);
                } catch (e) {
                    // Fail silently
                }
            }, [enabled]);

            const sounds = useMemo(() => ({
                click: () => playTone(800, 'sine', 0.1, 0.1),
                reset: () => {
                    if(!enabled) return;
                    playTone(400, 'square', 0.05, 0.05, 0);
                    playTone(500, 'square', 0.05, 0.05, 0.05);
                    playTone(600, 'square', 0.05, 0.05, 0.1);
                },
                toggle: () => playTone(300, 'square', 0.1, 0.05),
                cash: () => {
                    if(!enabled) return;
                    playTone(2000, 'sine', 0.4, 0.1, 0);
                    playTone(2500, 'sine', 0.4, 0.1, 0.05);
                    playTone(3000, 'sine', 0.5, 0.08, 0.1);
                    playTone(4000, 'triangle', 0.2, 0.05, 0.15);
                },
                reveal: () => {
                     if(!enabled) return;
                     playTone(523.25, 'sine', 0.2, 0.1);
                     // ‰ΩøÁî® try-catch ÂåÖË£πÔºåÈÅøÂÖçÂ†±ÈåØÂΩ±Èüø UI
                     try { setTimeout(() => playTone(1046.50, 'sine', 0.3, 0.1), 50); } catch(e){}
                }
            }), [enabled, playTone]);

            return sounds;
        };

        const AutoUpdateCheck = () => {
            useEffect(() => {
                const savedVersion = localStorage.getItem('cactpot_version');
                if (savedVersion !== BUILD_TIMESTAMP) {
                    localStorage.setItem('cactpot_version', BUILD_TIMESTAMP);
                    if (savedVersion) window.location.reload(true);
                }
            }, []);
            return null;
        };

        // --- Localization ---
        const LOCALE = {
            zh: {
                app_title: "FF14-‰ªô‰∫∫ÂæÆÂΩ©",
                title: "‰ªô‰∫∫ÂæÆÂΩ©Ê®°Êì¨Âô®",
                sum: "Á∏ΩÂíå",
                payout_title: "ÁçéÈáë‰∏ÄË¶ΩË°®",
                close_hint: "ÈªûÊìäËÉåÊôØÈóúÈñâ",
                select_num: "ÈÅ∏ÊìáÊï∏Â≠ó",
                clear_cell: "Ê∏ÖÈô§",
                analysis_title: "ÂÖ®ÈÉ®Ê©üÁéáÂàÜÊûê",
                click_hint: "ÈªûÊìäË°åÊü•Áúã",
                best_pick: "ÊúÄ‰Ω≥Êé®Ëñ¶",
                tap_hint: "ÈªûÈÅ∏Êü•ÁúãË©≥Á¥∞Ê©üÁéá üëÜ", // Êñ∞Â¢ûÊèêÁ§∫ÊñáÂ≠ó
                rank: "Rank",
                guaranteed: "‰øùÂ∫ï",
                view_details: "Êü•ÁúãË©≥ÊÉÖ",
                reset: "ÈáçÁΩÆÁõ§Èù¢",
                payout_btn: "ÁçéÈáëË°®",
                mode_on: "ÁÑ°ÈôêÂ°´Êï∏Â≠ó (Â∑≤ÈñãÂïü)",
                mode_off: "ÁÑ°ÈôêÂ°´Êï∏Â≠ó (ÈéñÂÆö‰∏≠)", 
                filled_status: "Â∑≤Â°´ÂØ´ {n}/9 Ê†º",
                reveal: "Êè≠Èñã!",
                row: "Ê©´Êéí",
                col: "Áõ¥Êéí",
                diag: "Â∞çËßí",
                label_10k: "1Ëê¨",
                label_3600: "3ÂçÉ6",
                ver_prefix: "ÁâàÊú¨Êõ¥Êñ∞Êñº",
                force_update: "Êõ¥Êñ∞È†ÅÈù¢",
                region: "Âè∞ÂåóÊôÇÈñì",
                sound_on: "Èü≥ÊïàÈñãÂïü",
                sound_off: "Èü≥ÊïàÈóúÈñâ"
            },
            en: {
                app_title: "FF14-Cactpot",
                title: "Mini Cactpot Solver",
                sum: "Sum",
                payout_title: "Payout Table",
                close_hint: "Tap background to close",
                select_num: "Select Number",
                clear_cell: "Clear",
                analysis_title: "All Probability",
                click_hint: "Tap row",
                best_pick: "Recommended",
                tap_hint: "Tap to view details üëÜ",
                rank: "Rank",
                guaranteed: "Guaranteed",
                view_details: "View Details",
                reset: "Reset Board",
                payout_btn: "Payouts",
                mode_on: "Infinite Fill (Active)", 
                mode_off: "Infinite Fill (Locked)", 
                filled_status: "Filled {n}/9",
                reveal: "Reveal!",
                row: "Row",
                col: "Col",
                diag: "Diag",
                label_10k: "10k",
                label_3600: "3.6k",
                ver_prefix: "Updated",
                force_update: "Refresh Page",
                region: "Taipei Time",
                sound_on: "Sound ON",
                sound_off: "Sound OFF"
            },
            ja: {
                app_title: "FF14-„Åè„Åò„ÉÜ„É≥„ÉÄ„Éº",
                title: "„Éü„Éã„Éª„Åè„Åò„ÉÜ„É≥„ÉÄ„Éº",
                sum: "ÂêàË®à",
                payout_title: "Ë≥ûÈáë‰∏ÄË¶ß",
                close_hint: "ËÉåÊôØ„Çø„ÉÉ„Éó„ÅßÈñâ„Åò„Çã",
                select_num: "Êï∞Â≠ó„ÇíÈÅ∏Êäû",
                clear_cell: "„ÇØ„É™„Ç¢",
                analysis_title: "ÂÖ®Á¢∫ÁéáÂàÜÊûê",
                click_hint: "Ë°å„Çí„Çø„ÉÉ„Éó",
                best_pick: "Êé®Â•®",
                tap_hint: "„Çø„ÉÉ„Éó„Åó„Å¶Ë©≥Á¥∞„ÇíË¶ã„Çã üëÜ",
                rank: "È†Ü‰Ωç",
                guaranteed: "Á¢∫ÂÆö",
                view_details: "Ë©≥Á¥∞„ÇíË¶ã„Çã",
                reset: "„É™„Çª„ÉÉ„Éà",
                payout_btn: "Ë≥ûÈáëË°®",
                mode_on: "ÁÑ°ÈôêÂÖ•Âäõ (Á∑®ÈõÜ‰∏≠)",
                mode_off: "ÁÑ°ÈôêÂÖ•Âäõ („É≠„ÉÉ„ÇØ‰∏≠)",
                filled_status: "ÂÖ•ÂäõÊ∏à„Åø {n}/9",
                reveal: "„ÇÅ„Åè„Çã!",
                row: "Ê®™",
                col: "Á∏¶",
                diag: "Êñú„ÇÅ",
                label_10k: "1‰∏á",
                label_3600: "3600",
                ver_prefix: "ÊúÄÁµÇÊõ¥Êñ∞",
                force_update: "„Éö„Éº„Ç∏Êõ¥Êñ∞",
                region: "Âè∞ÂåóÊôÇÈñì",
                sound_on: "Sound ON",
                sound_off: "Sound OFF"
            }
        };

        // --- Icons (SVG) ---
        const RefreshCw = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>;
        const Trophy = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>;
        const ChevronDown = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m6 9 6 6 6-6"/></svg>;
        const Unlock = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/></svg>;
        const Lock = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>;
        const BookOpen = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>;
        const X = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>;
        const Sparkles = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>;
        const RotateCcw = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>;
        const Volume2 = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>;
        const VolumeX = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><line x1="23" x2="17" y1="9" y2="15"/><line x1="17" x2="23" y1="9" y2="15"/></svg>;
        const Hand = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0"/><path d="M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2"/><path d="M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8"/><path d="M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"/></svg>;
        const TouchIcon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M19 14v4h-4"/><path d="M15 10V6h4"/><path d="M5 10V6H9"/><path d="M9 14v4H5"/></svg>;
        
        // Unified SVG Arrows
        const ArrowRight = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>;
        const ArrowDown = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5v14"/><path d="m19 12-7 7-7-7"/></svg>;
        const ArrowDownRight = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="m7 7 10 10"/><path d="M17 7v10H7"/></svg>;
        const ArrowDownLeft = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M17 7 7 17"/><path d="M7 7v10h10"/></svg>;

        const getArrowIcon = (lineId) => {
            if (lineId <= 2) return <ArrowRight />;
            if (lineId <= 5) return <ArrowDown />;
            if (lineId === 6) return <ArrowDownRight />;
            if (lineId === 7) return <ArrowDownLeft />;
            return null;
        };

        // --- Logic Constants ---
        const PAYOUTS = {
            6: 10000, 7: 36, 8: 720, 9: 360, 10: 80,
            11: 252, 12: 108, 13: 72, 14: 54, 15: 180,
            16: 72, 17: 180, 18: 119, 19: 36, 20: 306,
            21: 1080, 22: 144, 23: 1800, 24: 3600,
        };

        const LINES = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8], 
            [0, 3, 6], [1, 4, 7], [2, 5, 8], 
            [0, 4, 8], [2, 4, 6], 
        ];

        function getPermutations(arr) {
            if (arr.length === 0) return [[]];
            const firstEl = arr[0];
            const rest = arr.slice(1);
            const permsWithoutFirst = getPermutations(rest);
            const allPermutations = [];
            permsWithoutFirst.forEach((perm) => {
                for (let i = 0; i <= perm.length; i++) {
                allPermutations.push([...perm.slice(0, i), firstEl, ...perm.slice(i)]);
                }
            });
            return allPermutations;
        }

        const getPrizeStyle = (mgp) => {
            if (mgp === 10000) return "text-[#fcd34d] border-[#fcd34d]/50 bg-yellow-900/40 shadow-[0_0_10px_rgba(252,211,77,0.3)] font-bold"; 
            if (mgp === 3600 || mgp === 1800) return "text-fuchsia-300 border-fuchsia-500/40 bg-fuchsia-900/40 font-bold";
            if (mgp === 1080 || mgp === 720) return "text-cyan-300 border-cyan-500/40 bg-cyan-900/40 font-bold"; 
            return "text-[#a8a29e] border-[#57534e]/40 bg-[#1c1917]/60";
        };

        // --- Components ---

        const PayoutTableModal = ({ isOpen, onClose, t, playSound }) => {
            if (!isOpen) return null;
            
            const sortedPayouts = Object.entries(PAYOUTS).sort((a,b) => Number(a[0]) - Number(b[0]));
            const midPoint = Math.ceil(sortedPayouts.length / 2);
            const leftCol = sortedPayouts.slice(0, midPoint);
            const rightCol = sortedPayouts.slice(midPoint);

            const RowItem = ({ sum, mgp }) => {
                let rowBgClass = "bg-white/5 border-white/10";
                let textClass = "text-zinc-300";
                
                if (mgp === 10000) {
                    rowBgClass = "bg-gradient-to-r from-yellow-600/30 to-yellow-900/30 border-yellow-500/40";
                    textClass = "text-[#fcd34d] font-bold drop-shadow";
                } else if (mgp === 3600 || mgp === 1800) {
                    rowBgClass = "bg-gradient-to-r from-fuchsia-600/20 to-fuchsia-900/20 border-fuchsia-500/30";
                    textClass = "text-fuchsia-300 font-bold";
                } else if (mgp === 1080 || mgp === 720) {
                    rowBgClass = "bg-gradient-to-r from-cyan-600/20 to-cyan-900/20 border-cyan-500/30";
                    textClass = "text-cyan-300 font-bold";
                } else {
                    rowBgClass = "bg-[#d4af37]/10 border-[#d4af37]/20";
                    textClass = "text-[#d4af37]/80";
                }

                return (
                    <div className={`flex justify-between items-center p-2 rounded-lg h-9 border ${rowBgClass}`}>
                        <span className="text-[#d4af37]/70 font-mono text-xs">{t('sum')} <span className="text-white font-bold">{sum}</span></span>
                        <span className={`text-sm ${textClass}`}>
                            {mgp.toLocaleString()} <span className="text-[10px] opacity-70">MGP</span>
                        </span>
                    </div>
                );
            };

            return (
                <div className="fixed inset-0 z-[60] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-in fade-in duration-200" onClick={() => { playSound('click'); onClose(); }}>
                    <div onClick={(e) => e.stopPropagation()} className="casino-panel rounded-2xl w-full max-w-sm flex flex-col relative overflow-hidden">
                        <div className="p-4 border-b border-[#d4af37]/30 flex items-center justify-between bg-black/30">
                            <h3 className="text-gold font-bold text-lg flex items-center gap-2">
                                <Trophy className="w-5 h-5 text-[#d4af37]" /> {t('payout_title')}
                            </h3>
                            <button onClick={() => { playSound('click'); onClose(); }} className="text-[#d4af37] hover:text-white p-1 rounded-full hover:bg-white/10 transition-colors"><X className="w-6 h-6"/></button>
                        </div>
                        <div className="p-4">
                            <div className="flex gap-4">
                                <div className="flex-1 space-y-1.5">
                                    {leftCol.map(([sum, mgp]) => <RowItem key={sum} sum={sum} mgp={mgp} />)}
                                </div>
                                <div className="flex-1 space-y-1.5">
                                    {rightCol.map(([sum, mgp]) => <RowItem key={sum} sum={sum} mgp={mgp} />)}
                                </div>
                            </div>
                        </div>
                        <div className="p-3 text-center text-xs text-[#d4af37]/60 border-t border-[#d4af37]/30 bg-black/30">
                            {t('close_hint')}
                        </div>
                    </div>
                </div>
            );
        };

        const NumberSelector = ({ isOpen, onSelect, usedNumbers, currentValue, onClose, t, playSound }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-in fade-in duration-200" onClick={() => { playSound('click'); onClose(); }}>
                <div onClick={(e) => e.stopPropagation()} className="casino-panel rounded-3xl p-5 w-full max-w-[320px] grid grid-cols-3 gap-3">
                    <div className="col-span-3 text-center text-gold font-bold mb-3 uppercase tracking-widest text-sm">{t('select_num')}</div>
                    {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(num => {
                    const isUsed = usedNumbers.has(num) && num !== currentValue;
                    return (
                        <button
                        key={num}
                        disabled={isUsed}
                        onClick={() => { onSelect(num); }}
                        className={`
                            h-16 w-16 rounded-full font-bold text-2xl flex items-center justify-center transition-all btn-3d mx-auto
                            ${num === currentValue 
                                ? 'bg-gradient-to-b from-blue-500 to-blue-700 text-white border-2 border-blue-300 ring-2 ring-blue-500/50' 
                                : isUsed 
                                    ? 'bg-zinc-800 text-zinc-600 border-2 border-zinc-700 cursor-not-allowed shadow-none translate-y-[6px]' 
                                    : 'bg-gradient-to-b from-[#fcd34d] via-[#d4af37] to-[#b45309] text-[#451a03] border-2 border-[#fcd34d] hover:brightness-110'
                            }
                        `}
                        >
                        {num}
                        </button>
                    );
                    })}
                    <button onClick={() => { onSelect(null); }} className="btn-3d col-span-3 h-12 mt-3 font-bold text-white bg-gradient-to-b from-red-600 to-red-900 border-2 border-red-400 rounded-full flex items-center justify-center uppercase tracking-wider transition-transform shadow-lg">
                        {t('clear_cell')}
                    </button>
                </div>
                </div>
            );
        };

        // Main App
        function MiniCactpotSolver() {
            const [lang, setLang] = useState(() => {
                try { return localStorage.getItem('cactpot_lang') || 'zh'; } catch(e) { return 'zh'; }
            });

            useEffect(() => {
                try { localStorage.setItem('cactpot_lang', lang); } catch(e) {}
                const currentTitle = LOCALE[lang]['app_title'];
                document.title = currentTitle;
                const metaTitle = document.querySelector('meta[name="apple-mobile-web-app-title"]');
                if (metaTitle) metaTitle.setAttribute('content', currentTitle);
            }, [lang]);

            const [board, setBoard] = useState(Array(9).fill(null));
            const [openSelectorIndex, setOpenSelectorIndex] = useState(null);
            const [isFullFillMode, setIsFullFillMode] = useState(false);
            const [showPayouts, setShowPayouts] = useState(false);
            
            const [isSoundOn, setIsSoundOn] = useState(() => {
                try {
                    const saved = localStorage.getItem('cactpot_sound');
                    return saved === null ? true : saved === 'true'; 
                } catch(e) { return true; }
            });

            const toggleSound = () => {
                setIsSoundOn(prev => {
                    const newState = !prev;
                    try { localStorage.setItem('cactpot_sound', String(newState)); } catch(e) {}
                    return newState;
                });
            };

            const sounds = useSound(isSoundOn);
            
            const [solutions, setSolutions] = useState([]);
            const [bestLineIndex, setBestLineIndex] = useState(null);
            const [suggestedCellIndex, setSuggestedCellIndex] = useState(null);

            const t = (key) => LOCALE[lang][key] || key;

            const getLineName = (index) => {
                if (index <= 2) return `${t('row')} ${index + 1}`;
                if (index <= 5) return `${t('col')} ${index - 2}`;
                if (index === 6) return `${t('diag')} ‚Üò`;
                if (index === 7) return `${t('diag')} ‚Üô`;
                return "";
            };

            const filledCount = board.filter(n => n !== null).length;
            const isSelectionPhase = filledCount < 4; 
            const showAnalysis = !isSelectionPhase || isFullFillMode;

            const availableNumbers = useMemo(() => {
                const used = new Set(board.filter((n) => n !== null));
                return [1, 2, 3, 4, 5, 6, 7, 8, 9].filter((n) => !used.has(n));
            }, [board]);

            const usedNumbersSet = useMemo(() => new Set(board.filter((n) => n !== null)), [board]);

            useEffect(() => {
                const emptyIndices = board.map((val, idx) => (val === null ? idx : -1)).filter((idx) => idx !== -1);
                const perms = getPermutations(availableNumbers);
                
                const lineStats = LINES.map(() => ({ 
                    totalMGP: 0, 
                    chance10k: 0, 
                    chance3600: 0, 
                    counts: 0,
                    payoutDist: {}
                }));
                const cellImpactScore = Array(9).fill(0); 

                perms.forEach((perm) => {
                    const tempBoard = [...board];
                    perm.forEach((val, i) => tempBoard[emptyIndices[i]] = val);

                    LINES.forEach((lineIndices, lineId) => {
                        const sum = tempBoard[lineIndices[0]] + tempBoard[lineIndices[1]] + tempBoard[lineIndices[2]];
                        const payout = PAYOUTS[sum] || 0;
                        
                        lineStats[lineId].totalMGP += payout;
                        lineStats[lineId].counts++;
                        lineStats[lineId].payoutDist[payout] = (lineStats[lineId].payoutDist[payout] || 0) + 1;
                        
                        const isJackpot = sum === 6; 
                        const isSecond = sum === 24; 
                        
                        if (isJackpot) lineStats[lineId].chance10k++;
                        if (isSecond) lineStats[lineId].chance3600++;

                        if (isSelectionPhase && (isJackpot || isSecond)) {
                            lineIndices.forEach(cellIdx => {
                                if (board[cellIdx] === null) {
                                    cellImpactScore[cellIdx] += isJackpot ? 10 : 1; 
                                }
                            });
                        }
                    });
                });

                const results = lineStats.map(stat => {
                    if (stat.counts === 0) return { ev: 0, chance10k: 0, chance3600: 0, allProbs: [] };
                    
                    const allProbs = Object.entries(stat.payoutDist)
                        .map(([mgp, count]) => ({
                            mgp: parseInt(mgp),
                            percent: (count / stat.counts) * 100
                        }))
                        .filter(p => p.percent > 0) 
                        .sort((a, b) => b.mgp - a.mgp); 

                    return {
                        ev: Math.floor(stat.totalMGP / stat.counts),
                        chance10k: (stat.chance10k / stat.counts) * 100,
                        chance3600: (stat.chance3600 / stat.counts) * 100,
                        allProbs: allProbs
                    };
                });

                setSolutions(results);
                const maxEV = Math.max(...results.map(r => r.ev));
                setBestLineIndex(results.findIndex(r => r.ev === maxEV));

                if (isSelectionPhase && filledCount > 0) {
                    let maxScore = -1;
                    let bestCell = -1;
                    cellImpactScore.forEach((score, idx) => {
                        if (score > maxScore && board[idx] === null) maxScore = score, bestCell = idx;
                    });
                    if (bestCell === -1) {
                        const priority = [4, 0, 2, 6, 8, 1, 3, 5, 7];
                        bestCell = priority.find(idx => board[idx] === null) ?? -1;
                    }
                    setSuggestedCellIndex(bestCell);
                } else {
                    setSuggestedCellIndex(null);
                }
            }, [board, availableNumbers, filledCount, isSelectionPhase, isFullFillMode]);

            const handleSelect = (val) => {
                const newBoard = [...board];
                if (val !== null) {
                    const existingIdx = newBoard.indexOf(val);
                    if (existingIdx !== -1) newBoard[existingIdx] = null;
                }
                
                if (openSelectorIndex !== null) {
                    newBoard[openSelectorIndex] = val;
                    const newFilledCount = newBoard.filter(n => n !== null).length;
                    
                    // Èü≥ÊïàÊîπÁÇ∫ÂêåÊ≠•ÂëºÂè´ÔºåÈÅøÂÖçË¢´Êìã
                    if (newFilledCount === 4 && filledCount < 4) {
                        sounds.cash();
                    }
                }
                
                setBoard(newBoard);
                setOpenSelectorIndex(null);
            };

            const handleReset = () => {
                setBoard(Array(9).fill(null));
                setOpenSelectorIndex(null);
                setTimeout(() => sounds.reset(), 50);
            };

            const handleForceUpdate = () => {
                if(confirm("Á¢∫ÂÆöË¶ÅÈáçÊñ∞Êï¥ÁêÜÁ∂≤È†ÅÂóéÔºü")) {
                    window.location.reload(true);
                }
            }

            const Indicator = ({ lineId }) => {
                const ArrowIcon = getArrowIcon(lineId);
                
                if (!solutions[lineId]) return <div className="w-full h-full opacity-0"></div>;
                const { ev, chance10k } = solutions[lineId];
                const isBest = showAnalysis && lineId === bestLineIndex;
                const displayEv = ev >= 1000 ? (ev/1000).toFixed(1).replace('.0','') + 'k' : ev;

                return (
                <div className={`flex items-center justify-center w-full h-full p-0.5`}>
                    <div className={`
                    relative flex flex-col items-center justify-center w-12 h-12 rounded-full border-2 transition-all duration-300 shadow-md
                    ${isBest 
                        ? 'bg-gradient-to-b from-green-600 to-green-800 border-green-400 text-white shadow-[0_0_15px_rgba(0,255,0,0.5)] z-10 scale-110' 
                        : 'bg-black/60 border-[#d4af37]/30 text-[#d4af37]/70'}
                    `}>
                    <span className={`text-[10px] font-bold leading-none flex items-center justify-center ${isBest ? 'text-white drop-shadow' : ''}`}>
                        {displayEv}
                    </span>

                    {chance10k > 0 && (
                        <div className="absolute -top-1 -right-1">
                        <span className="flex h-3 w-3 relative">
                            <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75"></span>
                            <span className="relative inline-flex rounded-full h-3 w-3 bg-gradient-to-br from-yellow-300 to-yellow-600 border border-white shadow-sm"></span>
                        </span>
                        </div>
                    )}
                    <div className={`text-sm mt-0.5 ${isBest ? 'text-white animate-pulse drop-shadow-[0_0_5px_rgba(255,255,255,0.8)]' : ''}`}>
                        {ArrowIcon}
                    </div>
                    </div>
                </div>
                );
            };

            const GameCell = ({ idx }) => {
                const cellValue = board[idx];
                const isSuggested = isSelectionPhase && idx === suggestedCellIndex;
                const isLocked = !isFullFillMode && (cellValue === null && filledCount >= 4);

                return (
                    <button
                        disabled={isLocked}
                        onClick={() => {
                            if (!isLocked) {
                                setOpenSelectorIndex(idx);
                                if (isSuggested && !cellValue) sounds.reveal(); 
                                else sounds.click(); 
                            }
                        }}
                        className={`
                            circle-cell w-20 h-20 flex flex-col items-center justify-center text-4xl md:text-5xl font-bold transition-all duration-200 group
                            ${cellValue !== null ? 'filled' : ''}
                            ${isLocked ? 'opacity-40 cursor-not-allowed bg-black/40 border-[#4a0404]' : 'hover:scale-105 hover:border-[#fcd34d] active:scale-95'}
                            ${isSuggested && !cellValue ? 'suggested' : ''}
                        `}
                    >
                        {!cellValue && !isLocked && (
                             <div className="absolute inset-0 opacity-20 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDIwIDIwIj48Y2lyY2xlIGN4PSIxMCIgY3k9IjEwIiByPSIxIiBmaWxsPSIjZDRhZjM3Ii8+PC9zdmc+')] bg-center"></div>
                        )}

                        {cellValue ? (
                            <span className="drop-shadow-[0_2px_2px_rgba(0,0,0,0.8)] font-game">{cellValue}</span>
                        ) : (
                            !isLocked && <Sparkles className={`w-6 h-6 ${isSuggested ? 'text-white animate-pulse' : 'text-[#d4af37]/30'}`} />
                        )}
                        
                        {isSuggested && !cellValue && (
                            <div className="absolute inset-0 flex items-center justify-center">
                                <div className="bg-gradient-to-r from-purple-600 via-pink-600 to-blue-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-[0_0_10px_rgba(255,255,255,0.5)] animate-bounce border border-white/50 tracking-wider">
                                    {t('reveal')}
                                </div>
                            </div>
                        )}
                    </button>
                );
            }

            const AnalysisList = () => {
                if (!showAnalysis || solutions.length === 0) return null;

                const rankedSolutions = solutions
                    .map((sol, index) => ({ ...sol, originalIndex: index }))
                    .sort((a, b) => b.ev - a.ev);
                
                const [expandedLine, setExpandedLine] = useState(null);

                const toggleExpand = (idx) => {
                    sounds.click();
                    setExpandedLine(expandedLine === idx ? null : idx);
                };

                return (
                    <div className="w-full max-w-[400px] mt-8 animate-in slide-in-from-bottom-4 fade-in duration-500">
                        <div className="flex items-center gap-2 mb-3 px-2">
                            <h3 className="text-gold font-bold text-base tracking-wider uppercase drop-shadow-sm">{t('analysis_title')}</h3>
                            <span className="text-[10px] text-[#fcd34d]/80 ml-auto animate-pulse">{t('click_hint')}</span>
                        </div>
                        <div className="casino-panel rounded-2xl overflow-hidden divide-y divide-[#d4af37]/20">
                            {rankedSolutions.map((sol, rank) => {
                                const isBest = sol.originalIndex === bestLineIndex;
                                const name = getLineName(sol.originalIndex);
                                const ArrowIcon = getArrowIcon(sol.originalIndex);
                                const isExpanded = expandedLine === sol.originalIndex;
                                
                                const notablePrizes = sol.allProbs.filter(p => p.mgp >= 720).sort((a, b) => b.mgp - a.mgp);

                                return (
                                    <div key={sol.originalIndex} className="flex flex-col">
                                        <button 
                                            onClick={() => toggleExpand(sol.originalIndex)}
                                            className={`
                                                w-full flex items-center justify-between p-3 transition-all text-left border-l-4 group
                                                ${isBest ? 'bg-gradient-to-r from-green-900/50 to-transparent border-green-500' : 'hover:bg-white/5 border-transparent'}
                                                ${isExpanded ? 'bg-black/40' : ''}
                                            `}
                                        >
                                            <div className="flex items-center gap-3">
                                                <div className={`w-8 h-8 flex items-center justify-center rounded-full font-bold text-sm shadow-inner border ${isBest ? 'bg-green-700 border-green-400 text-white shadow-[0_0_10px_rgba(0,255,0,0.3)]' : 'bg-black/40 border-[#d4af37]/20 text-[#d4af37]/60'}`}>
                                                    {ArrowIcon}
                                                </div>
                                                <div className="flex flex-col">
                                                    <span className={`text-sm font-bold ${isBest ? 'text-green-400 drop-shadow' : 'text-zinc-300'}`}>{name}</span>
                                                    <span className="text-[10px] text-[#d4af37]/60 uppercase tracking-wider">{isBest ? t('best_pick') : `${t('rank')} #${rank+1}`}</span>
                                                </div>
                                            </div>
                                            
                                            <div className="flex flex-col items-end gap-1">
                                                <span className={`font-bold font-mono text-base ${isBest ? 'text-gold drop-shadow-sm' : 'text-zinc-300'}`}>
                                                    ${Math.floor(sol.ev).toLocaleString()}
                                                </span>
                                                
                                                <div className="flex flex-wrap justify-end gap-1.5 max-w-[180px]">
                                                    {/* ‚òÖ‚òÖ‚òÖ Â¶ÇÊûúÊòØ Best Pick ‰∏îÊ≤íÊúâÂ±ïÈñãÔºåÈ°ØÁ§∫ÂºïÂ∞éÊñáÂ≠ó ‚òÖ‚òÖ‚òÖ */}
                                                    {isBest && !isExpanded ? (
                                                        <div className="flex items-center gap-1 px-2 py-0.5 rounded-full border border-[#fcd34d] bg-[#fcd34d]/20 text-[#fcd34d] text-[10px] font-bold animate-pulse shadow-[0_0_10px_rgba(252,211,77,0.4)]">
                                                            {t('tap_hint')}
                                                        </div>
                                                    ) : (
                                                        notablePrizes.length > 0 ? (
                                                            notablePrizes.map(p => {
                                                                const badgeStyle = getPrizeStyle(p.mgp);
                                                                const textSize = p.mgp >= 10000 ? "text-xs" : "text-[10px]";
                                                                
                                                                return (
                                                                    <span key={p.mgp} className={`${textSize} px-1.5 py-0.5 rounded border ${badgeStyle} backdrop-blur-sm flex items-center`}>
                                                                        {p.mgp >= 10000 ? '1Ëê¨' : p.mgp}
                                                                        <span className="opacity-70 text-[9px] ml-0.5">:{p.percent.toFixed(0)}%</span>
                                                                    </span>
                                                                )
                                                            })
                                                        ) : (
                                                            <div className="flex items-center gap-1 px-2 py-0.5 rounded-full border border-[#d4af37]/40 bg-[#d4af37]/10 text-[#d4af37] text-[10px] shadow-sm group-hover:bg-[#d4af37]/20 transition-colors">
                                                                <TouchIcon className="w-3 h-3" />
                                                                {t('view_details')}
                                                            </div>
                                                        )
                                                    )}
                                                </div>
                                            </div>
                                            
                                            <div className="absolute right-2 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity">
                                                <ChevronDown className="w-4 h-4 text-[#fcd34d] drop-shadow-[0_0_5px_rgba(252,211,77,0.8)]"/>
                                            </div>
                                        </button>

                                        {isExpanded && (
                                            <div className="bg-black/40 p-3 shadow-inner border-t border-[#d4af37]/20 animate-in slide-in-from-top-2 duration-200">
                                                <div className="grid grid-cols-3 gap-2">
                                                    {sol.allProbs.map((prob) => {
                                                        const badgeStyle = getPrizeStyle(prob.mgp);

                                                        return (
                                                            <div key={prob.mgp} className={`flex flex-col items-center justify-center p-2 rounded-lg border shadow-sm ${badgeStyle} bg-opacity-20`}>
                                                                <span className="text-xs font-bold">
                                                                    {prob.mgp.toLocaleString()}
                                                                </span>
                                                                <span className="text-[10px] font-mono opacity-80">
                                                                    {prob.percent.toFixed(0)}%
                                                                </span>
                                                            </div>
                                                        )
                                                    })}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-start pt-8 pb-20 px-4 relative">
                
                <AutoUpdateCheck />

                <button 
                    onClick={() => { toggleSound(); setTimeout(() => sounds.toggle(), 0); }}
                    className="absolute top-4 left-4 z-40 flex items-center justify-center w-12 h-12 bg-black/40 backdrop-blur-md border border-[#d4af37]/30 rounded-full shadow-md text-[#d4af37]/60 hover:text-white transition-all active:scale-95"
                >
                    {isSoundOn ? <Volume2 className="w-6 h-6 text-[#d4af37]" /> : <VolumeX className="w-6 h-6 text-zinc-500" />}
                </button>

                <div className="absolute top-4 right-4 z-40 flex bg-black/40 backdrop-blur-md border border-[#d4af37]/30 rounded-full p-1 shadow-md">
                    {['zh', 'en', 'ja'].map(l => (
                        <button 
                            key={l}
                            onClick={() => { setLang(l); setTimeout(() => sounds.click(), 0); }}
                            className={`px-3 py-1 rounded-full text-xs font-bold uppercase transition-all ${lang === l ? 'bg-[#d4af37] text-black shadow-sm' : 'text-[#d4af37]/60 hover:text-white'}`}
                        >
                            {l === 'zh' ? 'ÁπÅ' : l === 'ja' ? 'Êó•' : l}
                        </button>
                    ))}
                </div>

                <div className="w-full max-w-md mb-6 text-center relative shrink-0">
                    <div className="absolute top-0 left-1/2 -translate-x-1/2 w-64 h-32 bg-red-600/30 blur-[80px] rounded-full pointer-events-none mix-blend-screen"></div>
                    <div className="relative flex flex-col items-center gap-3">
                        <Trophy className="w-8 h-8 text-[#d4af37] drop-shadow-[0_0_10px_rgba(212,175,55,0.8)]" />
                        <h1 className="text-gold text-3xl md:text-5xl font-game font-extrabold tracking-widest drop-shadow-[0_5px_5px_rgba(0,0,0,0.8)] leading-tight">
                            {t('title')}
                        </h1>
                        <div className="flex items-center gap-2 opacity-80">
                            <div className="h-[2px] w-16 bg-gradient-to-r from-transparent to-[#d4af37]"></div>
                            <div className="w-2 h-2 rotated-45 bg-[#d4af37] transform rotate-45"></div>
                            <div className="h-[2px] w-16 bg-gradient-to-l from-transparent to-[#d4af37]"></div>
                        </div>
                    </div>
                </div>

                <div className="mb-6 flex flex-col w-full max-w-[340px] gap-4 shrink-0 relative z-20">
                    <div className="flex gap-3">
                        <button 
                            onClick={handleReset}
                            className="flex-1 py-4 btn-3d bg-gradient-to-b from-[#7f1d1d] to-[#4a0404] border-2 border-[#991b1b] rounded-2xl text-red-100 font-bold tracking-wider flex items-center justify-center gap-2 shadow-lg group"
                        >
                            <RefreshCw className="w-5 h-5 group-hover:rotate-180 transition-transform duration-500" /> {t('reset')}
                        </button>
                        <button 
                            onClick={() => { setShowPayouts(true); setTimeout(() => sounds.click(), 0); }}
                            className="flex-1 py-4 btn-3d bg-gradient-to-b from-[#fcd34d] to-[#b45309] border-2 border-[#fcd34d] rounded-2xl text-[#451a03] font-bold tracking-wider flex items-center justify-center gap-2 shadow-lg group"
                        >
                            <BookOpen className="w-5 h-5 group-hover:scale-110 transition-transform" /> {t('payout_btn')}
                        </button>
                    </div>
                </div>

                <div className="w-full max-w-[420px] casino-panel rounded-[40px] p-6 flex flex-col justify-center shrink-0 shadow-[0_20px_50px_rgba(0,0,0,0.8)]">
                    <div className="grid grid-cols-[2.2rem_1fr_1fr_1fr_2.2rem] gap-1.5 md:gap-3 items-center justify-items-center w-full">
                        <Indicator lineId={6} /> 
                        <Indicator lineId={3} /> 
                        <Indicator lineId={4} /> 
                        <Indicator lineId={5} /> 
                        <Indicator lineId={7} /> 

                        <Indicator lineId={0} />
                        <GameCell idx={0} /> <GameCell idx={1} /> <GameCell idx={2} /> <div />

                        <Indicator lineId={1} />
                        <GameCell idx={3} /> <GameCell idx={4} /> <GameCell idx={5} /> <div />

                        <Indicator lineId={2} />
                        <GameCell idx={6} /> <GameCell idx={7} /> <GameCell idx={8} /> <div />
                    </div>
                </div>

                <div className="w-full max-w-[340px] mt-6 flex justify-center">
                    <button 
                        onClick={() => { setIsFullFillMode(!isFullFillMode); setTimeout(() => sounds.toggle(), 0); }}
                        className={`
                            px-6 py-2 rounded-full text-xs font-bold tracking-widest uppercase transition-all border
                            ${isFullFillMode 
                                ? 'bg-blue-900/50 border-blue-400 text-blue-200 shadow-[0_0_10px_rgba(59,130,246,0.5)]' 
                                : 'bg-transparent border-[#d4af37]/30 text-[#d4af37]/50 hover:bg-[#d4af37]/10 hover:text-[#d4af37]'}
                        `}
                    >
                        {isFullFillMode ? <span className="flex items-center gap-2"><Unlock className="w-3 h-3"/> {t('mode_on')}</span> : <span className="flex items-center gap-2"><Lock className="w-3 h-3"/> {t('mode_off')}</span>}
                    </button>
                </div>
                
                <AnalysisList />

                <div className="mt-12 flex flex-col items-center gap-2 pb-8 opacity-60 hover:opacity-100 transition-opacity">
                    <div className="text-[#d4af37] text-xs font-mono">
                        {t('ver_prefix')} {BUILD_TIMESTAMP} ({t('region')} GMT+8) {t('force_update').replace('È†ÅÈù¢','')}
                    </div>
                    <button onClick={handleForceUpdate} className="text-xs text-[#d4af37] underline flex items-center gap-1 hover:text-white">
                         <RotateCcw className="w-3 h-3" /> {t('force_update')}
                    </button>
                </div>

                <NumberSelector 
                    isOpen={openSelectorIndex !== null}
                    currentValue={openSelectorIndex !== null ? board[openSelectorIndex] : null}
                    usedNumbers={usedNumbersSet}
                    onSelect={handleSelect}
                    onClose={() => setOpenSelectorIndex(null)}
                    t={t}
                    playSound={val => val === 'select' ? null : (val === 'clear' ? null : sounds.click())}
                />
                
                <PayoutTableModal 
                    isOpen={showPayouts}
                    onClose={() => setShowPayouts(false)}
                    t={t}
                    playSound={sounds.click}
                />
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MiniCactpotSolver />);
    </script>
</body>
</html>