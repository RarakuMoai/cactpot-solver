<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data: 'unsafe-inline' 'unsafe-eval'; script-src 'self' https: 'unsafe-inline' 'unsafe-eval'; style-src 'self' https: 'unsafe-inline'; img-src 'self' https: data:; font-src 'self' https: data:;">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>FF14 ‰ªô‰∫∫ÂæÆÂΩ©Ë®àÁÆóÂô® (Mini Cactpot Solver) - ÊØèÊó• MGP ÂøÖ‰∏≠ÊîªÁï• & Ê©üÁéáÂàÜÊûê</title>
    
    <meta name="description" content="FF14 / FFXIV ‰ªô‰∫∫ÂæÆÂΩ©Ë®àÁÆóÂô® (Mini Cactpot Solver)„ÄÇÊîØÊè¥ÁπÅ‰∏≠„ÄÅÁ∞°‰∏≠„ÄÅËã±Êñá„ÄÅÊó•ÊñáÁ≠âÂ§öÂúãË™ûË®Ä„ÄÇÊèê‰æõÊØèÊó•‰ªô‰∫∫ÂΩ©ÊúÄ‰Ω≥Ë∑ØÂæëËàáÊúüÊúõÂÄºÂàÜÊûêÔºåÂπ´Âä©‰Ω†ËºïÈ¨ÜÁç≤ÂæóÊúÄÈ´ò MGP ÁçéÂãµÔºåÈáëÁ¢üÈÅäÊ®ÇÂ†¥ÂøÖÂÇôÊîªÁï•Â∑•ÂÖ∑„ÄÇ">
    <meta name="keywords" content="FF14, FFXIV, ‰ªô‰∫∫ÂæÆÂΩ©, ‰ªô‰∫∫ÂΩ©, Mini Cactpot, Solver, Ë®àÁÆóÂô®, Ë®àÁÆóÊ©ü, Ëß£È°åÂô®, ÊîªÁï•, MGP, ÈáëÁ¢üÈÅäÊ®ÇÂ†¥">
    
    <meta name="apple-mobile-web-app-title" content="FF14 Solver">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f0f11">

    <link rel="icon" type="image/png" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="manifest" href="manifest.json">

    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NL7CSVDZ');</script>
    
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --gold-primary: #d4af37;
            --gold-light: #fcd34d;
            --gold-dark: #927215;
            --casino-red: #4a0404;
            --casino-black: #0f0f11;
        }

        html {
            background-color: #0f0f11;
            height: 100%;
        }
        
        html::before {
            content: "Loading...";
            position: fixed;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #d4af37;
            font-family: sans-serif;
            font-weight: bold;
            font-size: 14px;
            letter-spacing: 4px;
            opacity: 0.8;
            z-index: -1;
        }

        body { 
            -webkit-tap-highlight-color: transparent; 
            font-family: "Segoe UI", "Microsoft JhengHei", sans-serif; 
            background-color: var(--casino-black);
            background-image: radial-gradient(circle at center top, #7f1d1d 0%, var(--casino-red) 40%, #000000 100%);
            background-size: 100% 100%;
            background-attachment: fixed;
            overflow-x: hidden; 
            color: #fff;
            min-height: 100%;
            position: relative;
            z-index: 1; 
        }
        
        .font-game { font-family: 'Cinzel', sans-serif; }

        .casino-pattern {
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 0l15 30-15 30-15-30z' fill='%23d4af37' fill-opacity='0.05'/%3E%3C/svg%3E");
            background-size: 60px 60px;
            opacity: 0.3;
            mix-blend-mode: overlay;
        }

        .select-none { user-select: none; -webkit-user-select: none; }
        ::-webkit-scrollbar { width: 0px; background: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .btn-3d {
            transition: all 0.1s;
            box-shadow: 0px 4px 0px 0px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.2);
            border-bottom: none;
        }
        .btn-3d:active {
            transform: translateY(4px);
            box-shadow: 0px 0px 0px 0px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.1);
        }
        
        .text-gold {
            background: linear-gradient(to bottom, var(--gold-light), var(--gold-primary), var(--gold-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0px 2px 2px rgba(0,0,0,0.8));
        }

        .casino-panel {
            background: linear-gradient(135deg, rgba(74, 4, 4, 0.9), rgba(15, 15, 17, 0.95));
            backdrop-filter: blur(8px);
            border: 2px solid var(--gold-primary);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5), inset 0 0 20px rgba(212, 175, 55, 0.1);
            position: relative;
        }
        .casino-panel::after {
            content: ''; position: absolute; inset: -4px; border: 1px solid var(--gold-light); border-radius: inherit; opacity: 0.3; pointer-events: none;
        }

        .circle-cell {
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #4a0404, #000);
            border: 3px solid var(--gold-primary);
            box-shadow: inset 0 0 20px rgba(0,0,0,1), 0 4px 10px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
            touch-action: manipulation;
        }
        .circle-cell.filled {
            background: radial-gradient(circle at 30% 30%, var(--gold-light), var(--gold-primary), #b45309);
            border-color: var(--gold-light);
            color: #451a03;
            text-shadow: 0 1px 0 rgba(255,255,255,0.4);
            box-shadow: inset 0 0 10px rgba(255,255,0,0.5), 0 0 20px rgba(212, 175, 55, 0.6);
        }
        @keyframes rainbow-pulse {
            0% { box-shadow: 0 0 20px rgba(255,0,0,0.8), 0 0 40px rgba(255,165,0,0.5); }
            25% { box-shadow: 0 0 20px rgba(255,255,0,0.8), 0 0 40px rgba(0,255,0,0.5); }
            50% { box-shadow: 0 0 20px rgba(0,255,255,0.8), 0 0 40px rgba(0,0,255,0.5); }
            75% { box-shadow: 0 0 20px rgba(128,0,128,0.8), 0 0 40px rgba(255,0,255,0.5); }
            100% { box-shadow: 0 0 20px rgba(255,0,0,0.8), 0 0 40px rgba(255,165,0,0.5); }
        }
        .circle-cell.suggested {
            border-color: #fff;
            animation: rainbow-pulse 3s linear infinite;
            z-index: 10;
        }
        @keyframes shimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }
        .jackpot-row-bg {
            background: linear-gradient(90deg, rgba(212,175,55,0.05), rgba(252,211,77,0.35), rgba(255,255,255,0.5), rgba(252,211,77,0.35), rgba(212,175,55,0.05));
            background-size: 200% auto;
            animation: shimmer 3s linear infinite;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .loading-spinner { width: 50px; height: 50px; border: 4px solid rgba(212, 175, 55, 0.2); border-top: 4px solid #fcd34d; border-radius: 50%; animation: spin 1s linear infinite; filter: drop-shadow(0 0 10px #fcd34d); }
        .loading-text { font-family: sans-serif; color: #d4af37; font-size: 14px; letter-spacing: 4px; margin-top: 20px; animation: pulse 2s infinite; font-weight: bold; text-shadow: 0 2px 4px rgba(0,0,0,0.8); }
    </style>
</head>
<body class="min-h-screen relative overflow-x-hidden font-sans">
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NL7CSVDZ" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    
    <div class="fixed inset-0 casino-pattern pointer-events-none z-0"></div>

    <div id="root" class="relative z-10">
        <div style="position:fixed; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:50;">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading...</div>
        </div>
    </div>

    <script type="text/babel">
        // -----------------------------------------------------------
        // ‚òÖ‚òÖ‚òÖ Ê†∏ÂøÉÈÅãÁÆóÁßªÊ§çÂçÄ (Core Logic Transplant) ‚òÖ‚òÖ‚òÖ
        // -----------------------------------------------------------
        
        // --- Áõ¥Êé•Êê¨ÁßªÂéüÂßãÁ¢ºÊï∏Êìö ---
        var payout = [NaN, NaN, NaN, NaN, NaN, NaN, 10000, 36, 720, 360, 80, 252, 108, 72, 54, 180, 72, 180, 119, 36, 306, 1080, 144, 1800, 3600];
        var EPS = 0.00001;

        var PerfectCactpot = {
            openings: {"100000000":[1677.7854166666664,[false,false,true,false,false,false,true,false,false]],"200000000":[1665.8127976190476,[false,false,true,false,false,false,true,false,false]],"300000000":[1662.504761904762,[false,false,true,false,false,false,true,false,false]],"400000000":[1365.0047619047618,[false,false,false,false,true,false,false,false,false]],"500000000":[1359.5589285714286,[false,false,false,false,true,false,false,false,false]],"600000000":[1364.3044642857142,[false,false,false,false,true,false,false,false,false]],"700000000":[1454.5455357142855,[false,false,false,false,true,false,false,false,false]],"800000000":[1527.0875,[false,false,true,false,true,false,true,false,false]],"900000000":[1517.7214285714285,[false,false,true,false,true,false,true,false,false]],"010000000":[1411.3541666666665,[false,false,false,false,true,false,false,false,false]],"020000000":[1414.9401785714288,[false,false,false,false,true,false,false,false,false]],"030000000":[1406.4190476190477,[false,false,false,false,true,false,false,false,false]],"040000000":[1443.3062499999999,[false,false,false,false,false,false,true,false,true]],"050000000":[1444.3172619047618,[false,false,false,false,true,false,true,false,true]],"060000000":[1441.3663690476192,[false,false,false,false,true,false,false,false,false]],"070000000":[1485.6839285714286,[false,false,false,false,true,false,false,false,false]],"080000000":[1512.927976190476,[true,false,true,false,false,false,false,false,false]],"090000000":[1518.466369047619,[true,false,true,false,false,false,false,false,false]],"001000000":[1677.7854166666664,[true,false,false,false,false,false,false,false,true]],"002000000":[1665.8127976190476,[true,false,false,false,false,false,false,false,true]],"003000000":[1662.504761904762,[true,false,false,false,false,false,false,false,true]],"004000000":[1365.0047619047618,[false,false,false,false,true,false,false,false,false]],"005000000":[1359.5589285714286,[false,false,false,false,true,false,false,false,false]],"006000000":[1364.3044642857142,[false,false,false,false,true,false,false,false,false]],"007000000":[1454.5455357142855,[false,false,false,false,true,false,false,false,false]],"008000000":[1527.0875,[true,false,false,false,true,false,false,false,true]],"009000000":[1517.7214285714285,[true,false,false,false,true,false,false,false,true]],"000100000":[1411.3541666666665,[false,false,false,false,true,false,false,false,false]],"000200000":[1414.9401785714288,[false,false,false,false,true,false,false,false,false]],"000300000":[1406.4190476190477,[false,false,false,false,true,false,false,false,false]],"000400000":[1443.3062499999999,[false,false,true,false,false,false,false,false,true]],"000500000":[1444.3172619047618,[false,false,true,false,true,false,false,false,true]],"000600000":[1441.3663690476192,[false,false,false,false,true,false,false,false,false]],"000700000":[1485.6839285714286,[false,false,false,false,true,false,false,false,false]],"000800000":[1512.927976190476,[true,false,false,false,false,false,true,false,false]],"000900000":[1518.466369047619,[true,false,false,false,false,false,true,false,false]],"000010000":[1860.4401785714285,[true,false,true,false,false,false,true,false,true]],"000020000":[1832.5413690476191,[true,false,true,false,false,false,true,false,true]],"000030000":[1834.179761904762,[true,false,true,false,false,false,true,false,true]],"000040000":[1171.9669642857143,[true,false,true,false,false,false,true,false,true]],"000050000":[1176.2047619047619,[true,false,true,false,false,false,true,false,true]],"000060000":[1234.6142857142856,[true,false,true,false,false,false,true,false,true]],"000070000":[1427.3583333333331,[true,false,true,false,false,false,true,false,true]],"000080000":[1544.7607142857144,[true,false,true,false,false,false,true,false,true]],"000090000":[1509.197619047619,[true,false,true,false,false,false,true,false,true]],"000001000":[1411.3541666666665,[false,false,false,false,true,false,false,false,false]],"000002000":[1414.9401785714288,[false,false,false,false,true,false,false,false,false]],"000003000":[1406.4190476190477,[false,false,false,false,true,false,false,false,false]],"000004000":[1443.3062499999999,[true,false,false,false,false,false,true,false,false]],"000005000":[1444.3172619047618,[true,false,false,false,true,false,true,false,false]],"000006000":[1441.3663690476192,[false,false,false,false,true,false,false,false,false]],"000007000":[1485.6839285714286,[false,false,false,false,true,false,false,false,false]],"000008000":[1512.927976190476,[false,false,true,false,false,false,false,false,true]],"000009000":[1518.466369047619,[false,false,true,false,false,false,false,false,true]],"000000100":[1677.7854166666664,[true,false,false,false,false,false,false,false,true]],"000000200":[1665.8127976190476,[true,false,false,false,false,false,false,false,true]],"000000300":[1662.504761904762,[true,false,false,false,false,false,false,false,true]],"000000400":[1365.0047619047618,[false,false,false,false,true,false,false,false,false]],"000000500":[1359.5589285714286,[false,false,false,false,true,false,false,false,false]],"000000600":[1364.3044642857142,[false,false,false,false,true,false,false,false,false]],"000000700":[1454.5455357142855,[false,false,false,false,true,false,false,false,false]],"000000800":[1527.0875,[true,false,false,false,true,false,false,false,true]],"000000900":[1517.7214285714285,[true,false,false,false,true,false,false,false,true]],"000000010":[1411.3541666666665,[false,false,false,false,true,false,false,false,false]],"000000020":[1414.9401785714288,[false,false,false,false,true,false,false,false,false]],"000000030":[1406.4190476190477,[false,false,false,false,true,false,false,false,false]],"000000040":[1443.3062499999999,[true,false,true,false,false,false,false,false,false]],"000000050":[1444.3172619047618,[true,false,true,false,true,false,false,false,false]],"000000060":[1441.3663690476192,[false,false,false,false,true,false,false,false,false]],"000000070":[1485.6839285714286,[false,false,false,false,true,false,false,false,false]],"000000080":[1512.927976190476,[false,false,false,false,false,false,true,false,true]],"000000090":[1518.466369047619,[false,false,false,false,false,false,true,false,true]],"000000001":[1677.7854166666664,[false,false,true,false,false,false,true,false,false]],"000000002":[1665.8127976190476,[false,false,true,false,false,false,true,false,false]],"000000003":[1662.504761904762,[false,false,true,false,false,false,true,false,false]],"000000004":[1365.0047619047618,[false,false,false,false,true,false,false,false,false]],"000000005":[1359.5589285714286,[false,false,false,false,true,false,false,false,false]],"000000006":[1364.3044642857142,[false,false,false,false,true,false,false,false,false]],"000000007":[1454.5455357142855,[false,false,false,false,true,false,false,false,false]],"000000008":[1527.0875,[false,false,true,false,true,false,true,false,false]],"000000009":[1517.7214285714285,[false,false,true,false,true,false,true,false,false]]},

            solve: function(state) {
                var revealed = state.filter(v => v > 0).length;
                if (revealed === 0) return [true, false, true, false, false, false, true, false, true];
                if (revealed === 1) {
                    var key = state.join('');
                    if (this.openings[key]) return this.openings[key][1];
                }
                var options = Array(9).fill(false);
                this.solve_any(state, payout, options);
                return options;
            },

            solve_any: function(state, rewards, options) {
                var dummy = [], unknowns = [], ids = [], has = [], tot_win = [];
                for (var i = 0; i < 9; i++) {
                    if (!state[i]) { ids.push(i); tot_win.push(0); }
                    else { has[state[i]] = 1; }
                }
                for (var i = 1; i <= 9; i++) { if (!has[i]) unknowns.push(i); }
                
                if (9 - ids.length >= 4) {
                    var perms = 0, win_sums = Array(8).fill(0);
                    this.permute(unknowns, p => {
                        perms++;
                        var s = [...state]; ids.forEach((id, idx) => s[id] = p[idx]);
                        win_sums[0] += rewards[s[0]+s[1]+s[2]]; win_sums[1] += rewards[s[3]+s[4]+s[5]];
                        win_sums[2] += rewards[s[6]+s[7]+s[8]]; win_sums[3] += rewards[s[0]+s[3]+s[6]];
                        win_sums[4] += rewards[s[1]+s[4]+s[7]]; win_sums[5] += rewards[s[2]+s[5]+s[8]];
                        win_sums[6] += rewards[s[0]+s[4]+s[8]]; win_sums[7] += rewards[s[2]+s[4]+s[6]];
                    });
                    var max = Math.max(...win_sums);
                    win_sums.forEach((v, i) => { if(v === max) options[i] = true; });
                    return max / perms;
                } else {
                    ids.forEach((id, idx) => {
                        unknowns.forEach(val => {
                            var s = [...state]; s[id] = val;
                            tot_win[idx] += this.solve_any(s, rewards, dummy);
                        });
                    });
                    var max = Math.max(...tot_win);
                    tot_win.forEach((v, i) => { if(v > max - EPS) options[ids[i]] = true; });
                    return max / unknowns.length;
                }
            },

            permute: function(a, cb) {
                var n = a.length, c = Array(n).fill(0), i = 1; cb(a);
                while (i < n) {
                    if (c[i] < i) {
                        var k = i % 2 && c[i]; [a[i], a[k]] = [a[k], a[i]];
                        cb(a); c[i]++; i = 1;
                    } else { c[i] = 0; i++; }
                }
            }
        };

        var Solver = {
            solve: function(table, payout) {
                var used = Array(10).fill(false), res = Array(8).fill(0), count = 0;
                table.flat().forEach(v => { if(v>0) used[v] = true; });
                
                var backtrack = (r, c) => {
                    if (r === 3) {
                        count++;
                        res[0] += payout[table[0][0]+table[0][1]+table[0][2]];
                        res[1] += payout[table[1][0]+table[1][1]+table[1][2]];
                        res[2] += payout[table[2][0]+table[2][1]+table[2][2]];
                        res[3] += payout[table[0][0]+table[1][0]+table[2][0]];
                        res[4] += payout[table[0][1]+table[1][1]+table[2][1]];
                        res[5] += payout[table[0][2]+table[1][2]+table[2][2]];
                        res[6] += payout[table[0][0]+table[1][1]+table[2][2]];
                        res[7] += payout[table[0][2]+table[1][1]+table[2][0]];
                        return;
                    }
                    var nextC = (c + 1) % 3, nextR = r + (c === 2 ? 1 : 0);
                    if (table[r][c] > 0) return backtrack(nextR, nextC);
                    for (var i = 1; i <= 9; i++) {
                        if (used[i]) continue;
                        used[i] = true; table[r][c] = i;
                        backtrack(nextR, nextC);
                        used[i] = false; table[r][c] = 0;
                    }
                };
                backtrack(0, 0);
                return res.map(v => v / count);
            }
        };

        // ÊôÇÂçÄÁµ±‰∏ÄÔºöUTC+8
        const getBuildTime = () => {
            try {
                const lastMod = new Date(document.lastModified);
                if(isNaN(lastMod.getTime())) return "ÂâõÂâõÊõ¥Êñ∞";
                return lastMod.toLocaleString('zh-TW', {
                    timeZone: 'Asia/Taipei',
                    year: 'numeric', month: '2-digit', day: '2-digit',
                    hour: '2-digit', minute: '2-digit', hour12: false
                });
            } catch(e) { return "Unknown Time"; }
        };
        const BUILD_TIMESTAMP = getBuildTime();

        const { useState, useEffect, useMemo, useRef, useCallback } = React;

        const useSound = (enabled) => {
            const audioCtxRef = useRef(null);

            const getCtx = useCallback(() => {
                if (!audioCtxRef.current) {
                    const Ctx = window.AudioContext || window.webkitAudioContext;
                    if (Ctx) {
                        audioCtxRef.current = new Ctx();
                    }
                }
                return audioCtxRef.current;
            }, []);

            const checkAndResume = useCallback(() => {
                const ctx = getCtx();
                if (ctx && ctx.state === 'suspended') {
                    ctx.resume().catch(e => console.error("Audio resume failed:", e));
                }
                return ctx;
            }, [getCtx]);

            useEffect(() => {
                const handleInteraction = () => {
                    const ctx = checkAndResume();
                    if (ctx) {
                        try {
                            const buffer = ctx.createBuffer(1, 1, 22050);
                            const source = ctx.createBufferSource();
                            source.buffer = buffer;
                            source.connect(ctx.destination);
                            source.start(0);
                        } catch(e) {}
                    }
                    window.removeEventListener('click', handleInteraction, true);
                    window.removeEventListener('touchstart', handleInteraction, true);
                };
                window.addEventListener('click', handleInteraction, true);
                window.addEventListener('touchstart', handleInteraction, true);
                return () => {
                    window.removeEventListener('click', handleInteraction, true);
                    window.removeEventListener('touchstart', handleInteraction, true);
                };
            }, [checkAndResume]);

            const playTone = useCallback((freq, type, duration, vol = 0.1, startTime = 0) => {
                if (!enabled) return;
                const ctx = checkAndResume();
                if (!ctx) return; 

                try {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.type = type;
                    osc.frequency.setValueAtTime(freq, ctx.currentTime + startTime);
                    gain.gain.setValueAtTime(vol, ctx.currentTime + startTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + startTime + duration);
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.start(ctx.currentTime + startTime);
                    osc.stop(ctx.currentTime + startTime + duration);
                } catch (e) {
                    console.error("Play tone error:", e);
                }
            }, [enabled, checkAndResume]);

            const sounds = useMemo(() => ({
                click: () => playTone(800, 'sine', 0.1, 0.1),
                reset: () => { 
                    playTone(400, 'square', 0.05, 0.05, 0); 
                    playTone(500, 'square', 0.05, 0.05, 0.05); 
                    playTone(600, 'square', 0.05, 0.05, 0.1); 
                },
                toggle: () => { 
                    checkAndResume(); 
                    playTone(300, 'square', 0.1, 0.05); 
                },
                cash: () => { 
                    playTone(2000, 'sine', 0.4, 0.1, 0); 
                    playTone(2500, 'sine', 0.4, 0.1, 0.05); 
                    playTone(3000, 'sine', 0.5, 0.08, 0.1); 
                    playTone(4000, 'triangle', 0.2, 0.05, 0.15); 
                },
                reveal: () => { 
                    playTone(523.25, 'sine', 0.2, 0.1); 
                    setTimeout(() => playTone(1046.50, 'sine', 0.3, 0.1), 50); 
                }
            }), [playTone, checkAndResume]);

            return sounds;
        };

        const AutoUpdateCheck = () => {
            useEffect(() => {
                const savedVersion = localStorage.getItem('cactpot_version');
                if (savedVersion !== BUILD_TIMESTAMP) {
                    localStorage.setItem('cactpot_version', BUILD_TIMESTAMP);
                    if (savedVersion) window.location.reload(true);
                }
            }, []);
            return null;
        };

        // 7 ÂúãË™ûË®ÄÂÖ®ÈÖç
        // 7 ÂúãË™ûË®ÄÂÖ®ÈÖç (Â∑≤Âä†ÂÖ• Yuryu Ëá¥Ë¨ù)
        const LOCALE = {
            zh: { app_title: "FF14-‰ªô‰∫∫ÂæÆÂΩ©Ë®àÁÆóÂô®", title: "‰ªô‰∫∫ÂæÆÂΩ©Ë®àÁÆóÂô®", sum: "Á∏ΩÂíå", payout_title: "ÁçéÈáë‰∏ÄË¶ΩË°®", close_hint: "ÈªûÊìäËÉåÊôØÈóúÈñâ", select_num: "ÈÅ∏ÊìáÊï∏Â≠ó", clear_cell: "Ê∏ÖÈô§", analysis_title: "ÂÖ®ÈÉ®Ê©üÁéáÂàÜÊûê", best_pick: "ÊúÄ‰Ω≥Êé®Ëñ¶", tap_view: "ÈªûÊìäÊü•ÁúãË©≥Á¥∞ üëÜ", rank: "Rank", guaranteed: "‰øùÂ∫ï", view_details: "Êü•ÁúãË©≥ÊÉÖ", reset: "ÈáçÁΩÆÁõ§Èù¢", payout_btn: "ÁçéÈáëË°®", 
                  mode_on: "ÁÑ°ÈôêÂ°´Êï∏Â≠óÊ®°Âºè (Â∑≤ÈñãÂïü)", mode_off: "ÁÑ°ÈôêÂ°´Êï∏Â≠óÊ®°Âºè (ÈéñÂÆö‰∏≠)", 
                  reveal: "Êè≠Èñã!", row: "Ê©´Êéí", col: "Áõ¥Êéí", diag: "Â∞çËßí", label_10k: "10k", label_3600: "3.6k", ver_prefix: "ÁâàÊú¨Êõ¥Êñ∞Êñº", force_update: "Êõ¥Êñ∞È†ÅÈù¢", region: "UTC+8", 
                  sound_on: "Èü≥ÊïàÈñãÂïü", sound_off: "Èü≥ÊïàÈóúÈñâ", jackpot: "JACKPOT", lang_select: "ÈÅ∏ÊìáË™ûË®Ä",
                  install_btn: "APPÂÆâË£ùÊïôÂ≠∏", share: "ÂàÜ‰∫´",
                  ios_title: "iOS ÂÆâË£ùÊ≠•È©ü", android_title: "Android ÂÆâË£ùÊ≠•È©ü",
                  ios_step1: "‰ΩøÁî® Safari ÈñãÂïü", ios_step2: "ÈªûÊìäÁÄèË¶ΩÂô®‰∏ãÊñπ„Äê‚Äß‚Äß‚Äß„Äë", ios_step3: "ÈªûÊìä„ÄêÂàÜ‰∫´„ÄëÂúñÁ§∫", ios_step4: "ÈªûÊìä„Äê‚Äß‚Äß‚Äß„Äë„ÄêÊõ¥Â§ö„Äë", ios_step5: "ÈÅ∏Êìá„ÄåÂä†ÂÖ•‰∏ªÁï´Èù¢„Äç",
                  android_step1: "‰ΩøÁî® Chrome ÈñãÂïü", android_step2: "ÈªûÊìäÂè≥‰∏äËßíÈÅ∏ÂñÆ„Äê‚ãÆ„Äë", android_step3: "ÈÅ∏Êìá„ÄåÂä†Âà∞‰∏ªÁï´Èù¢„Äç", android_step4: "ÈªûÊìä„ÄåÊñ∞Â¢û„Äç",
                  copy_link: "Ë§áË£ΩÈÄ£Áµê", link_copied: "ÈÄ£ÁµêÂ∑≤Ë§áË£Ω!", android_open_chrome: "Áî® Chrome ÈñãÂïü",
                  // ÈóúÊñº
                  about_btn: "ÈóúÊñº‰ΩúËÄÖ",
                  about_title: "Âó®ÔºÅÊàëÊòØ‰æÜËá™Âè∞ÁÅ£ÁöÑ Raraku Ÿ©(Àä·óúÀã*)Ÿà",
                  about_desc1: "ÈÄôÊòØÊàëÂü∫ÊñºËààË∂£Ë£Ω‰ΩúÁöÑÈùûÁáüÂà©Â∞èÂ∑•ÂÖ∑ÔºåÂ∏åÊúõËÉΩÂπ´ÂêÑ‰ΩçÂÖâ‰πãÊà∞Â£´Âú®ÈáëÁ¢üÈÅäÊ®ÇÂ†¥ËºïÈ¨ÜË≥∫Â§ßÈå¢ÔºÅ‚ú®",
                  // ‰øÆÊîπÈªûÔºö‰ΩøÁî®„ÄåÂèÉËÄÉ‰∏¶ÁßªÊ§ç„Äç
                  about_desc2: "Êú¨Â∞àÊ°àÁî± Gemini AI Âçî‰ΩúÈñãÁôº„ÄÇÊ†∏ÂøÉÊºîÁÆóÊ≥ïÂèÉËÄÉ‰∏¶ÁßªÊ§çËá™ Yuryu ÁöÑ PerfectCactpot ÈÇèËºØ„ÄÇÂ¶ÇÊúâ‰ªª‰ΩïÂª∫Ë≠∞ÔºåÊ≠°ËøéÈö®ÊôÇÂØ´‰ø°ÂëäË®¥ÊàëÔΩû",
                  contact_label: "ÂØÑ‰ø°Áµ¶ Raraku"
            },
            
            cn: { app_title: "FF14-‰ªô‰∫∫ÂæÆÂΩ©ËÆ°ÁÆóÂô®", title: "‰ªô‰∫∫ÂæÆÂΩ©ËÆ°ÁÆóÂô®", sum: "ÊÄªÂíå", payout_title: "Â•ñÈáë‰∏ÄËßàË°®", close_hint: "ÁÇπÂáªËÉåÊôØÂÖ≥Èó≠", select_num: "ÈÄâÊã©Êï∞Â≠ó", clear_cell: "Ê∏ÖÈô§", analysis_title: "ÂÖ®Ê¶ÇÁéáÂàÜÊûê", best_pick: "ÊúÄ‰Ω≥Êé®Ëçê", tap_view: "ÁÇπÂáªÊü•ÁúãËØ¶ÁªÜ üëÜ", rank: "Rank", guaranteed: "‰øùÂ∫ï", view_details: "Êü•ÁúãËØ¶ÊÉÖ", reset: "ÈáçÁΩÆÁõòÈù¢", payout_btn: "Â•ñÈáëË°®", 
                  mode_on: "Êó†ÈôêÂ°´Êï∞Â≠óÊ®°Âºè (Â∑≤ÂºÄÂêØ)", mode_off: "Êó†ÈôêÂ°´Êï∞Â≠óÊ®°Âºè (ÈîÅÂÆö‰∏≠)", 
                  reveal: "Êè≠ÂºÄ!", row: "Ê®™Êéí", col: "Á´ñÊéí", diag: "ÂØπËßí", label_10k: "10k", label_3600: "3.6k", ver_prefix: "ÁâàÊú¨Êõ¥Êñ∞‰∫é", force_update: "Âà∑Êñ∞È°µÈù¢", region: "UTC+8", 
                  sound_on: "Èü≥ÊïàÂºÄÂêØ", sound_off: "Èü≥ÊïàÂÖ≥Èó≠", jackpot: "JACKPOT", lang_select: "ÈÄâÊã©ËØ≠Ë®Ä",
                  install_btn: "APPÂÆâË£ÖÊïôÂ≠¶", share: "ÂàÜ‰∫´",
                  ios_title: "iOS ÂÆâË£ÖÊ≠•È™§", android_title: "Android ÂÆâË£ÖÊ≠•È™§",
                  ios_step1: "‰ΩøÁî® Safari ÂºÄÂêØ", ios_step2: "ÁÇπÂáªÊµèËßàÂô®‰∏ãÊñπ„Äê‚Äß‚Äß‚Äß„Äë", ios_step3: "ÁÇπÂáª„ÄêÂàÜ‰∫´„ÄëÂõæÁ§∫", ios_step4: "ÁÇπÂáª„Äê‚Äß‚Äß‚Äß„Äë„ÄêÊõ¥Â§ö„Äë", ios_step5: "ÈÄâÊã©„ÄåÂä†ÂÖ•‰∏ªÁîªÈù¢„Äç",
                  android_step1: "‰ΩøÁî® Chrome ÂºÄÂêØ", android_step2: "ÁÇπÂáªÂè≥‰∏äËßíËèúÂçï„Äê‚ãÆ„Äë", android_step3: "ÈÄâÊã©„ÄåÂä†Âà∞‰∏ªÁîªÈù¢„Äç", android_step4: "ÁÇπÂáª„ÄåÊñ∞Â¢û„Äç",
                  copy_link: "Â§çÂà∂ÈìæÊé•", link_copied: "ÈìæÊé•Â∑≤Â§çÂà∂!", android_open_chrome: "Áî® Chrome ÂºÄÂêØ",
                  // ÈóúÊñº
                  about_btn: "ÂÖ≥‰∫é‰ΩúËÄÖ",
                  about_title: "Âó®ÔºÅÊàëÊòØÊù•Ëá™Âè∞ÊπæÁöÑ Raraku Ÿ©(Àä·óúÀã*)Ÿà",
                  about_desc1: "ËøôÊòØÊàëÂü∫‰∫éÂÖ¥Ë∂£Âà∂‰ΩúÁöÑÈùûËê•Âà©Â∞èÂ∑•ÂÖ∑ÔºåÂ∏åÊúõËÉΩÂ∏ÆÂêÑ‰ΩçÂÖâ‰πãÊàòÂ£´Âú®ÈáëÁ¢üÊ∏∏‰πêÂú∫ËΩªÊùæËµöÂ§ßÈí±ÔºÅ‚ú®",
                  // ‰øÆÊîπÈªûÔºö‰ΩøÁî®„ÄåÂèÇËÄÉÂπ∂ÁßªÊ§ç„Äç
                  about_desc2: "Êú¨‰∏ìÊ°àÁî± Gemini AI Âçè‰ΩúÂºÄÂèë„ÄÇÊ†∏ÂøÉÁÆóÊ≥ïÂèÇËÄÉÂπ∂ÁßªÊ§çËá™ Yuryu ÁöÑ PerfectCactpot ÈÄªËæë„ÄÇÂ¶ÇÊúâ‰ªª‰ΩïÂª∫ËÆÆÔºåÊ¨¢ËøéÈöèÊó∂ÂÜô‰ø°ÂëäËØâÊàëÔΩû",
                  contact_label: "ÂØÑ‰ø°Áªô Raraku"
            },
            
            en: { app_title: "FF14-Cactpot Solver", title: "Mini Cactpot Solver", sum: "Sum", payout_title: "Payout Table", close_hint: "Tap background to close", select_num: "Select Number", clear_cell: "Clear", analysis_title: "All Probability", best_pick: "Recommended", tap_view: "Tap for Details üëÜ", rank: "Rank", guaranteed: "Guaranteed", view_details: "View Details", reset: "Reset Board", payout_btn: "Payouts", 
                  mode_on: "Infinite Fill Mode (Active)", mode_off: "Infinite Fill Mode (Locked)", 
                  reveal: "Reveal!", row: "Row", col: "Col", diag: "Diag", label_10k: "10k", label_3600: "3.6k", ver_prefix: "Updated", force_update: "Refresh Page", region: "UTC+8", 
                  sound_on: "Sound ON", sound_off: "Sound OFF", jackpot: "JACKPOT", lang_select: "Select Language",
                  install_btn: "Install Guide", share: "Share",
                  ios_title: "iOS Installation", android_title: "Android Installation",
                  ios_step1: "Open in Safari", ios_step2: "Tap [‚Äß‚Äß‚Äß] at bottom", ios_step3: "Tap [Share] icon", ios_step4: "Tap [‚Äß‚Äß‚Äß] More", ios_step5: "Select 'Add to Home Screen'",
                  android_step1: "Open in Chrome", android_step2: "Tap menu [‚ãÆ] at top right", android_step3: "Select 'Add to Home screen'", android_step4: "Tap 'Add'",
                  copy_link: "Copy Link", link_copied: "Copied!", android_open_chrome: "Open in Chrome",
                  // About
                  about_btn: "About Author",
                  about_title: "Hi! I'm Raraku from Taiwan Ÿ©(Àä·óúÀã*)Ÿà",
                  about_desc1: "Just a hobby project made with love! Hope this helps all Warriors of Light earn big MGP at the Gold Saucer! ‚ú®",
                  // ‰øÆÊîπÈªûÔºö‰ΩøÁî® "Core logic based on/ported from"
                  about_desc2: "Co-coded with Gemini AI. Core algorithm logic is based on Yuryu's PerfectCactpot. Feel free to contact me for any suggestions!",
                  contact_label: "Email Raraku"
            },
            
            ja: { app_title: "FF14-„Åè„Åò„ÉÜ„É≥„ÉÄ„ÉºË®àÁÆóÊ©ü", title: "„Éü„Éã„Éª„Åè„Åò„ÉÜ„É≥„ÉÄ„ÉºË®àÁÆóÊ©ü", sum: "ÂêàË®à", payout_title: "Ë≥ûÈáë‰∏ÄË¶ß", close_hint: "ËÉåÊôØ„Çø„ÉÉ„Éó„ÅßÈñâ„Åò„Çã", select_num: "Êï∞Â≠ó„ÇíÈÅ∏Êäû", clear_cell: "„ÇØ„É™„Ç¢", analysis_title: "ÂÖ®Á¢∫ÁéáÂàÜÊûê", best_pick: "Êé®Â•®", tap_view: "Ë©≥Á¥∞„ÇíË¶ã„Çã üëÜ", rank: "È†Ü‰Ωç", guaranteed: "Á¢∫ÂÆö", view_details: "Ë©≥Á¥∞„ÇíË¶ã„Çã", reset: "„É™„Çª„ÉÉ„Éà", payout_btn: "Ë≥ûÈáëË°®", 
                  mode_on: "ÁÑ°ÈôêÂÖ•Âäõ„É¢„Éº„Éâ (Á∑®ÈõÜ‰∏≠)", mode_off: "ÁÑ°ÈôêÂÖ•Âäõ„É¢„Éº„Éâ („É≠„ÉÉ„ÇØ)", 
                  reveal: "„ÇÅ„Åè„Çã!", row: "Ê®™", col: "Á∏¶", diag: "Êñú„ÇÅ", label_10k: "10k", label_3600: "3.6k", ver_prefix: "ÊúÄÁµÇÊõ¥Êñ∞", force_update: "„Éö„Éº„Ç∏Êõ¥Êñ∞", region: "UTC+8", 
                  sound_on: "Sound ON", sound_off: "Sound OFF", jackpot: "JACKPOT", lang_select: "Ë®ÄË™û„ÇíÈÅ∏Êäû",
                  install_btn: "„Ç¢„Éó„É™Â∞éÂÖ•Ê≥ï", share: "ÂÖ±Êúâ",
                  ios_title: "iOS „Ç§„É≥„Çπ„Éà„Éº„É´ÊâãÈ†Ü", android_title: "Android „Ç§„É≥„Çπ„Éà„Éº„É´ÊâãÈ†Ü",
                  ios_step1: "Safari„ÅßÈñã„Åè", ios_step2: "‰∏ã„ÅÆ [‚Äß‚Äß‚Äß] „Çí„Çø„ÉÉ„Éó", ios_step3: "[ÂÖ±Êúâ] „Çí„Çø„ÉÉ„Éó", ios_step4: "[‚Äß‚Äß‚Äß] „Åù„ÅÆ‰ªñ„Çí„Çø„ÉÉ„Éó", ios_step5: "[„Éõ„Éº„É†ÁîªÈù¢„Å´ËøΩÂä†] „ÇíÈÅ∏Êäû",
                  android_step1: "Chrome„ÅßÈñã„Åè", android_step2: "Âè≥‰∏ä„ÅÆ„É°„Éã„É•„Éº [‚ãÆ] „Çí„Çø„ÉÉ„Éó", android_step3: "„Äå„Éõ„Éº„É†ÁîªÈù¢„Å´ËøΩÂä†„Äç„ÇíÈÅ∏Êäû", android_step4: "„ÄåËøΩÂä†„Äç„Çí„Çø„ÉÉ„Éó",
                  copy_link: "„É™„É≥„ÇØ„Çí„Ç≥„Éî„Éº", link_copied: "„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü!", android_open_chrome: "Chrome„ÅßÈñã„Åè",
                  // About
                  about_btn: "‰ΩúËÄÖ„Å´„Å§„ÅÑ„Å¶", about_title: "Hi! Âè∞ÊπæÂá∫Ë∫´„ÅÆ Raraku „Åß„Åô Ÿ©(Àä·óúÀã*)Ÿà", about_desc1: "Ë∂£Âë≥„Åß‰Ωú„Å£„ÅüÈùûÂñ∂Âà©„ÉÑ„Éº„É´„Åß„Åô„ÄÇÂÖâ„ÅÆÊà¶Â£´„ÅÆÁöÜ„Åï„Çì„ÅåMGP„ÇíÁ®º„Åê„ÅÆ„Å´„ÅäÂΩπ„Å´Á´ã„Å¶„Å∞Â¨â„Åó„ÅÑ„Åß„ÅôÔºÅ‚ú®", 
                  // ‰øÆÊîπÈªûÔºö‰ΩøÁî® "ÂèÇËÄÉ„ÉªÁßªÊ§ç„Åó„Åæ„Åó„Åü"
                  about_desc2: "Gemini AI„Å®ÂÖ±ÂêåÈñãÁô∫„Åó„Åæ„Åó„ÅüÔºÅ„Ç≥„Ç¢„Ç¢„É´„Ç¥„É™„Ç∫„É†„ÅØYuryuÊ∞è„ÅÆPerfectCactpot„ÇíÂèÇËÄÉ„Å´„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ‰∏çÂÖ∑Âêà„ÇÑÊèêÊ°à„Åå„ÅÇ„Çå„Å∞„ÄÅÊ∞óËªΩ„Å´„É°„Éº„É´„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºÅ", 
                  contact_label: "Raraku„Å´„É°„Éº„É´"
            },
            
            de: { app_title: "FF14-Gl√ºckskaktor Solver", title: "Mini-Gl√ºckskaktor Solver", sum: "Summe", payout_title: "Gewinntabelle", close_hint: "Zum Schlie√üen tippen", select_num: "Zahl w√§hlen", clear_cell: "L√∂schen", analysis_title: "Wahrscheinlichkeit", best_pick: "Empfohlen", tap_view: "Details antippen üëÜ", rank: "Rang", guaranteed: "Garantiert", view_details: "Details", reset: "Zur√ºcksetzen", payout_btn: "Gewinne", 
                  mode_on: "Frei-Eingabe-Modus (Ein)", mode_off: "Frei-Eingabe-Modus (Aus)", 
                  reveal: "Aufdecken!", row: "Reihe", col: "Spalte", diag: "Diag", label_10k: "10k", label_3600: "3.6k", ver_prefix: "Aktualisiert", force_update: "Aktualisieren", region: "UTC+8", 
                  sound_on: "Ton AN", sound_off: "Ton AUS", jackpot: "JACKPOT", lang_select: "Sprache w√§hlen",
                  install_btn: "Installationshilfe", share: "Teilen",
                  ios_title: "iOS Installation", android_title: "Android Installation",
                  ios_step1: "In Safari √∂ffnen", ios_step2: "Tippe auf [‚Äß‚Äß‚Äß]", ios_step3: "Tippe auf [Teilen]", ios_step4: "Tippe auf [‚Äß‚Äß‚Äß] Mehr", ios_step5: "W√§hle 'Zum Home-Bildschirm'",
                  android_step1: "In Chrome √∂ffnen", android_step2: "Tippe oben rechts auf [‚ãÆ]", android_step3: "W√§hle 'Zum Startbildschirm'", android_step4: "Tippe auf 'Hinzuf√ºgen'",
                  copy_link: "Link kopieren", link_copied: "Kopiert!", android_open_chrome: "In Chrome √∂ffnen",
                  // About
                  about_btn: "√úber den Autor", about_title: "Hallo! Ich bin Raraku aus Taiwan Ÿ©(Àä·óúÀã*)Ÿà", about_desc1: "Ein nicht-kommerzielles Hobbyprojekt! Ich hoffe, es hilft allen Kriegern des Lichts, MGP zu verdienen! ‚ú®", 
                  // ‰øÆÊîπÈªûÔºö‰ΩøÁî® "basiert auf"
                  about_desc2: "Programmiert mit Gemini AI! Der Kernalgorithmus basiert auf Yuryus PerfectCactpot. Bei Bugs oder Vorschl√§gen einfach melden!", 
                  contact_label: "Email an Raraku"
            },
            
            fr: { app_title: "FF14-Mini Cactpot Solver", title: "Mini Cactpot Solver", sum: "Somme", payout_title: "Tableau des gains", close_hint: "Touchez pour fermer", select_num: "Choisir un nombre", clear_cell: "Effacer", analysis_title: "Probabilit√©s", best_pick: "Recommand√©", tap_view: "Voir d√©tails üëÜ", rank: "Rang", guaranteed: "Garanti", view_details: "D√©tails", reset: "R√©initialiser", payout_btn: "Gains", 
                  mode_on: "Mode Saisie Libre (Actif)", mode_off: "Mode Saisie Libre (Verrou)", 
                  reveal: "R√©v√©ler!", row: "Rang√©e", col: "Colonne", diag: "Diag", label_10k: "10k", label_3600: "3.6k", ver_prefix: "Mise √† jour", force_update: "Actualiser", region: "UTC+8", 
                  sound_on: "Son ON", sound_off: "Son OFF", jackpot: "JACKPOT", lang_select: "Choisir la langue",
                  install_btn: "Guide d'installation", share: "Partager",
                  ios_title: "Installation iOS", android_title: "Installation Android",
                  ios_step1: "Ouvrir dans Safari", ios_step2: "Touchez [‚Äß‚Äß‚Äß]", ios_step3: "Touchez [Partager]", ios_step4: "Touchez [‚Äß‚Äß‚Äß] Plus", ios_step5: "S√©lectionnez 'Sur l'√©cran d'accueil'",
                  android_step1: "Ouvrir dans Chrome", android_step2: "Touchez [‚ãÆ] en haut √† droite", android_step3: "S√©lectionnez 'Ajouter √† l'√©cran d'accueil'", android_step4: "Touchez 'Ajouter'",
                  copy_link: "Copier le lien", link_copied: "Copi√©!", android_open_chrome: "Ouvrir dans Chrome",
                  // About
                  about_btn: "√Ä propos de l'auteur", about_title: "Salut ! Je suis Raraku de Ta√Øwan Ÿ©(Àä·óúÀã*)Ÿà", about_desc1: "Un projet amateur √† but non lucratif ! J'esp√®re que cela aidera les Guerriers de la Lumi√®re √† gagner des MGP ! ‚ú®", 
                  // ‰øÆÊîπÈªûÔºö‰ΩøÁî® "bas√© sur"
                  about_desc2: "Cod√© avec Gemini AI ! L'algorithme principal est bas√© sur le PerfectCactpot de Yuryu. Si vous trouvez des bugs, contactez-moi !", 
                  contact_label: "Email √† Raraku"
            },
            
            ko: { app_title: "FF14-ÎØ∏Îãà ÌÖêÎçî Í≥ÑÏÇ∞Í∏∞", title: "ÎØ∏Îãà ÌÖêÎçî Í≥ÑÏÇ∞Í∏∞", sum: "Ìï©Í≥Ñ", payout_title: "ÎãπÏ≤®Í∏à ÏùºÎûå", close_hint: "Î∞∞Í≤ΩÏùÑ ÎàåÎü¨ Îã´Í∏∞", select_num: "Ïà´Ïûê ÏÑ†ÌÉù", clear_cell: "ÏßÄÏö∞Í∏∞", analysis_title: "ÌôïÎ•† Î∂ÑÏÑù", best_pick: "Ï∂îÏ≤ú", tap_view: "ÏÉÅÏÑ∏ Î≥¥Í∏∞ üëÜ", rank: "ÏàúÏúÑ", guaranteed: "Î≥¥Ïû•", view_details: "ÏÉÅÏÑ∏ Ï†ïÎ≥¥", reset: "Ï¥àÍ∏∞Ìôî", payout_btn: "ÎãπÏ≤®Í∏à", 
                  mode_on: "Î¨¥Ìïú ÏûÖÎ†• Î™®Îìú (ÏºúÏßê)", mode_off: "Î¨¥Ìïú ÏûÖÎ†• Î™®Îìú (Í∫ºÏßê)", 
                  reveal: "ÌôïÏù∏!", row: "Í∞ÄÎ°ú", col: "ÏÑ∏Î°ú", diag: "ÎåÄÍ∞ÅÏÑ†", label_10k: "10k", label_3600: "3.6k", ver_prefix: "ÏóÖÎç∞Ïù¥Ìä∏", force_update: "ÏÉàÎ°úÍ≥†Ïπ®", region: "UTC+8", 
                  sound_on: "ÏÜåÎ¶¨ ÏºúÍ∏∞", sound_off: "ÏÜåÎ¶¨ ÎÅÑÍ∏∞", jackpot: "JACKPOT", lang_select: "Ïñ∏Ïñ¥ ÏÑ†ÌÉù",
                  install_btn: "ÏÑ§Ïπò Í∞ÄÏù¥Îìú", share: "Í≥µÏú†",
                  ios_title: "iOS ÏÑ§Ïπò Î∞©Î≤ï", android_title: "Android ÏÑ§Ïπò Î∞©Î≤ï",
                  ios_step1: "SafariÏóêÏÑú Ïó¥Í∏∞", ios_step2: "ÌïòÎã® [‚Äß‚Äß‚Äß] ÌÅ¥Î¶≠", ios_step3: "[Í≥µÏú†] ÏïÑÏù¥ÏΩò ÌÅ¥Î¶≠", ios_step4: "[‚Äß‚Äß‚Äß] ÎçîÎ≥¥Í∏∞ ÌÅ¥Î¶≠", ios_step5: "'Ìôà ÌôîÎ©¥Ïóê Ï∂îÍ∞Ä' ÏÑ†ÌÉù",
                  android_step1: "ChromeÏóêÏÑú Ïó¥Í∏∞", android_step2: "Ïò§Î•∏Ï™Ω ÏÉÅÎã® [‚ãÆ] ÌÅ¥Î¶≠", android_step3: "'Ìôà ÌôîÎ©¥Ïóê Ï∂îÍ∞Ä' ÏÑ†ÌÉù", android_step4: "'Ï∂îÍ∞Ä' ÌÅ¥Î¶≠",
                  copy_link: "ÎßÅÌÅ¨ Î≥µÏÇ¨", link_copied: "Î≥µÏÇ¨Îê®!", android_open_chrome: "ChromeÏóêÏÑú Ïó¥Í∏∞",
                  // About
                  about_btn: "Ï†úÏûëÏûê ÏÜåÍ∞ú", about_title: "ÏïàÎÖï! ÎåÄÎßåÏùò Raraku ÏûÖÎãàÎã§ Ÿ©(Àä·óúÀã*)Ÿà", about_desc1: "Ï∑®ÎØ∏Î°ú ÎßåÎì† ÎπÑÏòÅÎ¶¨ ÎèÑÍµ¨ÏûÖÎãàÎã§. ÎπõÏùò Ï†ÑÏÇ¨ Ïó¨Îü¨Î∂ÑÏù¥ MGPÎ•º Î≤ÑÎäî Îç∞ ÎèÑÏõÄÏù¥ ÎêòÍ∏∞Î•º Î∞îÎûçÎãàÎã§! ‚ú®", 
                  // ‰øÆÊîπÈªûÔºö‰ΩøÁî® "Í∏∞Î∞òÏúºÎ°ú Ìï©ÎãàÎã§" (Based on)
                  about_desc2: "Gemini AIÏôÄ Í≥µÎèô Í∞úÎ∞úÌñàÏäµÎãàÎã§! ÌïµÏã¨ ÏïåÍ≥†Î¶¨Ï¶òÏùÄ YuryuÏùò PerfectCactpotÏùÑ Í∏∞Î∞òÏúºÎ°ú Ìï©ÎãàÎã§. Î≤ÑÍ∑∏ÎÇò Ï†úÏïà ÏÇ¨Ìï≠Ïù¥ ÏûàÏúºÎ©¥ Î©îÏùº Ï£ºÏÑ∏Ïöî!", 
                  contact_label: "RarakuÏóêÍ≤å Î©îÏùº Î≥¥ÎÇ¥Í∏∞"
            }
        };

        // --- Icons ---
        const RefreshCw = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>;
        const Trophy = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>;
        const Unlock = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/></svg>;
        const Lock = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>;
        const BookOpen = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>;
        const X = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>;
        
        // ‚òÖ‚òÖ‚òÖ ‰øÆÊ≠£ÂæåÁöÑÊòüÊòü (Sparkles) ÂúñÁ§∫ÔºöÈÇÑÂéüÁÇ∫ÂñÆÈ°ÜÊòüÊòü ‚òÖ‚òÖ‚òÖ
        const Sparkles = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>;

        const RotateCcw = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>;
        const Volume2 = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>;
        const VolumeX = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><line x1="23" x2="17" y1="9" y2="15"/><line x1="17" x2="23" y1="9" y2="15"/></svg>;
        const Globe = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><line x1="2" x2="22" y1="12" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>;
        const ShareIcon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" x2="12" y1="2" y2="15"/></svg>;
        const Download = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>;
        const Copy = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>;
        const ExternalLink = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></svg>;

        const ArrowRight = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>;
        const ArrowDown = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5v14"/><path d="m19 12-7 7-7-7"/></svg>;
        const ArrowDownRight = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="m7 7 10 10"/><path d="M17 7v10H7"/></svg>;
        const ArrowDownLeft = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M17 7 7 17"/><path d="M7 7v10h10"/></svg>;

        const getArrowIcon = (lineId) => {
            if (lineId <= 2) return <ArrowRight />;
            if (lineId <= 5) return <ArrowDown />;
            if (lineId === 6) return <ArrowDownRight />;
            if (lineId === 7) return <ArrowDownLeft />;
            return null;
        };

        const PAYOUTS = {
            6: 10000, 7: 36, 8: 720, 9: 360, 10: 80,
            11: 252, 12: 108, 13: 72, 14: 54, 15: 180,
            16: 72, 17: 180, 18: 119, 19: 36, 20: 306,
            21: 1080, 22: 144, 23: 1800, 24: 3600,
        };

        const LINES = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8], 
            [0, 3, 6], [1, 4, 7], [2, 5, 8], 
            [0, 4, 8], [2, 4, 6], 
        ];

        function getPermutations(arr) {
            if (arr.length === 0) return [[]];
            const firstEl = arr[0];
            const rest = arr.slice(1);
            const permsWithoutFirst = getPermutations(rest);
            const allPermutations = [];
            permsWithoutFirst.forEach((perm) => {
                for (let i = 0; i <= perm.length; i++) {
                allPermutations.push([...perm.slice(0, i), firstEl, ...perm.slice(i)]);
                }
            });
            return allPermutations;
        }

        const getPrizeStyle = (mgp) => {
            if (mgp === 10000) return "text-[#fcd34d] border-[#fcd34d]/50 bg-yellow-900/40 shadow-[0_0_10px_rgba(252,211,77,0.3)] font-bold"; 
            if (mgp === 3600 || mgp === 1800) return "text-fuchsia-300 border-fuchsia-500/40 bg-fuchsia-900/40 font-bold";
            if (mgp === 1080 || mgp === 720) return "text-cyan-300 border-cyan-500/40 bg-cyan-900/40 font-bold"; 
            return "text-[#a8a29e] border-[#57534e]/40 bg-[#1c1917]/60";
        };

        const PayoutTableModal = ({ isOpen, onClose, t, playSound }) => {
            if (!isOpen) return null;
            const sortedPayouts = Object.entries(PAYOUTS).sort((a,b) => Number(a[0]) - Number(b[0]));
            const midPoint = Math.ceil(sortedPayouts.length / 2);
            const leftCol = sortedPayouts.slice(0, midPoint);
            const rightCol = sortedPayouts.slice(midPoint);

            const RowItem = ({ sum, mgp }) => {
                let rowBgClass = "bg-white/5 border-white/10";
                let textClass = "text-zinc-300";
                let isJackpot = false;
                if (mgp === 10000) { rowBgClass = "border-[#d4af37] relative overflow-hidden shadow-[0_0_15px_rgba(212,175,55,0.4)]"; textClass = "text-[#fcd34d] font-bold drop-shadow"; isJackpot = true; } 
                else if (mgp === 3600 || mgp === 1800) { rowBgClass = "bg-gradient-to-r from-fuchsia-600/20 to-fuchsia-900/20 border-fuchsia-500/30"; textClass = "text-fuchsia-300 font-bold"; } 
                else if (mgp === 1080 || mgp === 720) { rowBgClass = "bg-gradient-to-r from-cyan-600/20 to-cyan-900/20 border-cyan-500/30"; textClass = "text-cyan-300 font-bold"; } 
                else { rowBgClass = "bg-[#d4af37]/10 border-[#d4af37]/20"; textClass = "text-[#d4af37]/80"; }

                return (
                    <div className={`flex justify-between items-center px-3 rounded-lg h-9 border ${rowBgClass}`}>
                        {isJackpot && <div className="absolute inset-0 jackpot-row-bg -z-10 pointer-events-none opacity-80"></div>}
                        <span className="text-[#d4af37]/70 font-mono text-xs">{t('sum')} <span className="text-white font-bold">{sum}</span></span>
                        <span className={`text-sm ${textClass}`}>{mgp.toLocaleString()} <span className="text-[10px] opacity-70">MGP</span></span>
                    </div>
                );
            };

            return (
                <div className="fixed inset-0 z-[60] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-in fade-in duration-200" onClick={() => { playSound('click'); onClose(); }}>
                    <div onClick={(e) => e.stopPropagation()} className="casino-panel rounded-2xl w-full max-w-sm flex flex-col relative overflow-hidden">
                        <div className="p-4 border-b border-[#d4af37]/30 flex items-center justify-between bg-black/30">
                            <h3 className="text-gold font-bold text-lg flex items-center gap-2"><Trophy className="w-5 h-5 text-[#d4af37]" /> {t('payout_title')}</h3>
                            <button onClick={() => { playSound('click'); onClose(); }} className="text-[#d4af37] hover:text-white p-1 rounded-full hover:bg-white/10 transition-colors"><X className="w-6 h-6"/></button>
                        </div>
                        <div className="p-4">
                            <div className="flex gap-4">
                                <div className="flex-1 space-y-2">{leftCol.map(([sum, mgp]) => <RowItem key={sum} sum={sum} mgp={mgp} />)}</div>
                                <div className="flex-1 space-y-2">{rightCol.map(([sum, mgp]) => <RowItem key={sum} sum={sum} mgp={mgp} />)}</div>
                            </div>
                        </div>
                        <div className="p-3 text-center text-xs text-[#d4af37]/60 border-t border-[#d4af37]/30 bg-black/30">{t('close_hint')}</div>
                    </div>
                </div>
            );
        };

        const LanguageModal = ({ isOpen, onClose, currentLang, setLang, t, playSound }) => {
            if (!isOpen) return null;

            const languages = [
                { code: 'zh', label: 'ÁπÅÈ´î‰∏≠Êñá', native: 'Traditional Chinese' },
                { code: 'cn', label: 'ÁÆÄ‰Ωì‰∏≠Êñá', native: 'Simplified Chinese' },
                { code: 'en', label: 'English', native: 'English' },
                { code: 'ja', label: 'Êó•Êú¨Ë™û', native: 'Japanese' },
                { code: 'de', label: 'Deutsch', native: 'German' },
                { code: 'fr', label: 'Fran√ßais', native: 'French' },
                { code: 'ko', label: 'ÌïúÍµ≠Ïñ¥', native: 'Korean' },
            ];

            return (
                 <div className="fixed inset-0 z-[70] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-in fade-in duration-200" onClick={() => { playSound('click'); onClose(); }}>
                    <div onClick={(e) => e.stopPropagation()} className="casino-panel rounded-2xl w-full max-w-xs flex flex-col relative overflow-hidden">
                        <div className="p-4 border-b border-[#d4af37]/30 flex items-center justify-between bg-black/30">
                            <h3 className="text-gold font-bold text-lg flex items-center gap-2"><Globe className="w-5 h-5 text-[#d4af37]" /> {t('lang_select')}</h3>
                            <button onClick={() => { playSound('click'); onClose(); }} className="text-[#d4af37] hover:text-white p-1 rounded-full hover:bg-white/10 transition-colors"><X className="w-6 h-6"/></button>
                        </div>
                        <div className="p-4 grid gap-2 max-h-[60vh] overflow-y-auto">
                            {languages.map(l => (
                                <button
                                    key={l.code}
                                    onClick={() => { setLang(l.code); playSound('click'); onClose(); }}
                                    className={`
                                        w-full py-3 px-4 rounded-xl text-left transition-all border
                                        ${currentLang === l.code 
                                            ? 'bg-[#d4af37] text-black border-[#fcd34d] font-bold shadow-lg' 
                                            : 'bg-black/40 text-[#d4af37] border-[#d4af37]/20 hover:bg-[#d4af37]/10 hover:border-[#d4af37]/50'}
                                    `}
                                >
                                    <div className="flex items-center justify-between">
                                        <span>{l.label}</span>
                                        <span className={`text-xs ${currentLang === l.code ? 'text-black/60' : 'text-[#d4af37]/50'}`}>{l.code.toUpperCase()}</span>
                                    </div>
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        const NumberSelector = ({ isOpen, onSelect, usedNumbers, currentValue, onClose, t, playSound }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-in fade-in duration-200" onClick={() => { playSound('click'); onClose(); }}>
                <div onClick={(e) => e.stopPropagation()} className="casino-panel rounded-3xl p-5 w-full max-w-[320px] grid grid-cols-3 gap-3">
                    <div className="col-span-3 text-center text-gold font-bold mb-3 uppercase tracking-widest text-sm">{t('select_num')}</div>
                    {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(num => {
                    const isUsed = usedNumbers.has(num) && num !== currentValue;
                    return (
                        <button key={num} disabled={isUsed} onClick={() => { onSelect(num); }} className={`h-16 w-16 rounded-full font-bold text-2xl flex items-center justify-center transition-all btn-3d mx-auto ${num === currentValue ? 'bg-gradient-to-b from-blue-500 to-blue-700 text-white border-2 border-blue-300 ring-2 ring-blue-500/50' : isUsed ? 'bg-zinc-800 text-zinc-600 border-2 border-zinc-700 cursor-not-allowed shadow-none translate-y-[4px]' : 'bg-gradient-to-b from-[#fcd34d] via-[#d4af37] to-[#b45309] text-[#451a03] border-2 border-[#fcd34d] hover:brightness-110'}`}>{num}</button>
                    );
                    })}
                    <button onClick={() => { onSelect(null); }} className="btn-3d col-span-3 h-12 mt-3 font-bold text-white bg-gradient-to-b from-red-600 to-red-900 border-2 border-red-400 rounded-full flex items-center justify-center uppercase tracking-wider transition-transform shadow-lg">{t('clear_cell')}</button>
                </div>
                </div>
            );
        };

        const InstallModal = ({ isOpen, onClose, t, playSound }) => {
            if (!isOpen) return null;

            const [activeTab, setActiveTab] = useState(() => {
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
                return isIOS ? 'ios' : 'android';
            });

            const handleCopyLink = async () => {
                try {
                    await navigator.clipboard.writeText(window.location.href);
                    alert(t('link_copied'));
                } catch (err) {}
            };

            const handleOpenChrome = () => {
                const currentUrl = window.location.href.replace('https://', '').replace('http://', '');
                const intentUrl = `intent://${currentUrl}#Intent;scheme=https;package=com.android.chrome;end`;
                window.location.href = intentUrl;
            };

            return (
                <div className="fixed inset-0 z-[80] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-in fade-in duration-200" onClick={() => { playSound('click'); onClose(); }}>
                    <div onClick={(e) => e.stopPropagation()} className="casino-panel rounded-2xl w-full max-w-sm flex flex-col relative overflow-hidden">
                        
                        <div className="flex border-b border-[#d4af37]/30 bg-black/30">
                            <button onClick={() => { setActiveTab('ios'); playSound('click'); }} className={`flex-1 py-3 text-sm font-bold transition-colors ${activeTab === 'ios' ? 'text-[#fcd34d] bg-[#d4af37]/10 border-b-2 border-[#fcd34d]' : 'text-[#d4af37]/50 hover:text-[#d4af37]'}`}>iOS</button>
                            <button onClick={() => { setActiveTab('android'); playSound('click'); }} className={`flex-1 py-3 text-sm font-bold transition-colors ${activeTab === 'android' ? 'text-[#fcd34d] bg-[#d4af37]/10 border-b-2 border-[#fcd34d]' : 'text-[#d4af37]/50 hover:text-[#d4af37]'}`}>Android</button>
                            <button onClick={() => { playSound('click'); onClose(); }} className="absolute top-2 right-2 text-[#d4af37]/60 hover:text-white p-1"><X className="w-5 h-5"/></button>
                        </div>

                        <div className="p-6 min-h-[240px] flex flex-col justify-center">
                            {activeTab === 'ios' ? (
                                <div className="space-y-4">
                                    <h4 className="text-[#fcd34d] font-bold text-center mb-4">{t('ios_title')}</h4>
                                    <div className="space-y-2 text-sm text-zinc-300">
                                        <div className="flex flex-col gap-2 p-3 rounded-lg bg-white/5 border border-[#d4af37]/20">
                                            <div className="flex gap-3 items-center">
                                                <div className="bg-[#d4af37] text-black w-6 h-6 rounded-full flex items-center justify-center font-bold text-xs shrink-0 shadow-lg">1</div>
                                                <p className="flex-1 font-medium">{t('ios_step1')}</p>
                                            </div>
                                            <button onClick={handleCopyLink} className="ml-9 flex items-center gap-1.5 text-[#d4af37] text-[10px] font-bold border border-[#d4af37]/50 px-2 py-1 rounded bg-[#d4af37]/10 hover:bg-[#d4af37]/20 w-fit transition-colors">
                                                <Copy className="w-3 h-3" /> {t('copy_link')}
                                            </button>
                                        </div>
                                        <div className="flex gap-3 items-center p-3 rounded-lg bg-white/5 border border-[#d4af37]/20">
                                            <div className="bg-[#d4af37] text-black w-6 h-6 rounded-full flex items-center justify-center font-bold text-xs shrink-0 shadow-lg">2</div>
                                            <p className="flex-1 font-medium">{t('ios_step2')}</p>
                                        </div>
                                        <div className="flex gap-3 items-center p-3 rounded-lg bg-white/5 border border-[#d4af37]/20">
                                            <div className="bg-[#d4af37] text-black w-6 h-6 rounded-full flex items-center justify-center font-bold text-xs shrink-0 shadow-lg">3</div>
                                            <p className="flex-1 font-medium">{t('ios_step3')}</p>
                                        </div>
                                        <div className="flex gap-3 items-center p-3 rounded-lg bg-white/5 border border-[#d4af37]/20">
                                            <div className="bg-[#d4af37] text-black w-6 h-6 rounded-full flex items-center justify-center font-bold text-xs shrink-0 shadow-lg">4</div>
                                            <p className="flex-1 font-medium">{t('ios_step4')}</p>
                                        </div>
                                        <div className="flex gap-3 items-center p-3 rounded-lg bg-white/5 border border-[#d4af37]/20">
                                            <div className="bg-[#d4af37] text-black w-6 h-6 rounded-full flex items-center justify-center font-bold text-xs shrink-0 shadow-lg">5</div>
                                            <p className="flex-1 font-medium">{t('ios_step5')}</p>
                                        </div>
                                    </div>
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    <h4 className="text-[#fcd34d] font-bold text-center mb-4">{t('android_title')}</h4>
                                    <div className="space-y-2 text-sm text-zinc-300">
                                        <div className="flex flex-col gap-2 p-3 rounded-lg bg-white/5 border border-[#d4af37]/20">
                                            <div className="flex gap-3 items-center">
                                                <div className="bg-[#d4af37] text-black w-6 h-6 rounded-full flex items-center justify-center font-bold text-xs shrink-0 shadow-lg">1</div>
                                                <p className="flex-1 font-medium">{t('android_step1')}</p>
                                            </div>
                                            <div className="ml-9 flex gap-2">
                                                <button onClick={handleCopyLink} className="flex items-center gap-1.5 text-[#d4af37] text-[10px] font-bold border border-[#d4af37]/50 px-2 py-1 rounded bg-[#d4af37]/10 hover:bg-[#d4af37]/20 w-fit transition-colors">
                                                    <Copy className="w-3 h-3" /> {t('copy_link')}
                                                </button>
                                                <button onClick={handleOpenChrome} className="flex items-center gap-1.5 text-[#d4af37] text-[10px] font-bold border border-[#d4af37]/50 px-2 py-1 rounded bg-[#d4af37]/10 hover:bg-[#d4af37]/20 w-fit transition-colors">
                                                    <ExternalLink className="w-3 h-3" /> {t('android_open_chrome')}
                                                </button>
                                            </div>
                                        </div>
                                        <div className="flex gap-3 items-center p-3 rounded-lg bg-white/5 border border-[#d4af37]/20">
                                            <div className="bg-[#d4af37] text-black w-6 h-6 rounded-full flex items-center justify-center font-bold text-xs shrink-0 shadow-lg">2</div>
                                            <p className="flex-1 font-medium">{t('android_step2')}</p>
                                        </div>
                                        <div className="flex gap-3 items-center p-3 rounded-lg bg-white/5 border border-[#d4af37]/20">
                                            <div className="bg-[#d4af37] text-black w-6 h-6 rounded-full flex items-center justify-center font-bold text-xs shrink-0 shadow-lg">3</div>
                                            <p className="flex-1 font-medium">{t('android_step3')}</p>
                                        </div>
                                        <div className="flex gap-3 items-center p-3 rounded-lg bg-white/5 border border-[#d4af37]/20">
                                            <div className="bg-[#d4af37] text-black w-6 h-6 rounded-full flex items-center justify-center font-bold text-xs shrink-0 shadow-lg">4</div>
                                            <p className="flex-1 font-medium">{t('android_step4')}</p>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const AboutModal = ({ isOpen, onClose, t, playSound }) => {
            const [copyStatus, setCopyStatus] = useState(null); 

            if (!isOpen) return null;

            const handleContact = () => {
                playSound('click');
                const email = "yayoi991331@gmail.com";
                
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(email).then(() => {
                        setCopyStatus('copied');
                        setTimeout(() => setCopyStatus(null), 2000); 
                    }).catch(() => {});
                }
                window.location.href = `mailto:${email}`;
            };

            const isChinese = t('contact_label').includes('ÂØÑ‰ø°') || t('contact_label').includes('‰ø°');
            const copiedText = isChinese ? "Email Â∑≤Ë§áË£ΩÔºÅ" : "Email Copied!";

            return (
                <div className="fixed inset-0 z-[90] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-in fade-in duration-200" onClick={() => { playSound('click'); onClose(); }}>
                    <div onClick={(e) => e.stopPropagation()} className="casino-panel rounded-2xl w-full max-w-sm flex flex-col relative overflow-hidden">
                        <div className="p-4 border-b border-[#d4af37]/30 flex items-center justify-between bg-black/30">
                            <h3 className="text-gold font-bold text-lg flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5 text-[#d4af37]" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
                                {t('about_title')}
                            </h3>
                            <button onClick={() => { playSound('click'); onClose(); }} className="text-[#d4af37] hover:text-white p-1 rounded-full hover:bg-white/10 transition-colors"><X className="w-6 h-6"/></button>
                        </div>
                        <div className="p-6 text-zinc-300 text-sm leading-relaxed space-y-4">
                            <p>{t('about_desc1')}</p>
                            <div className="p-3 bg-white/5 rounded-lg border border-[#d4af37]/20 flex gap-3 items-start">
                                <Sparkles className="w-5 h-5 text-[#fcd34d] shrink-0 mt-0.5" />
                                <p className="text-xs text-[#d4af37]/90">{t('about_desc2')}</p>
                            </div>
                            
                            <button 
                               onClick={handleContact}
                               className={`flex items-center justify-center gap-2 w-full py-3 mt-2 rounded-xl font-bold shadow-lg transition-all active:scale-95 border ${copyStatus === 'copied' ? 'bg-green-600 text-white border-green-400' : 'bg-[#d4af37] text-black border-[#fcd34d] hover:bg-[#fcd34d]'}`}>
                                {copyStatus === 'copied' ? (
                                    <>
                                        <svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
                                        <span>{copiedText}</span>
                                    </>
                                ) : (
                                    <>
                                        <span>‚úâÔ∏è {t('contact_label')}</span>
                                    </>
                                )}
                            </button>
                            <div className="text-center text-[10px] text-[#d4af37]/50 font-mono select-all cursor-text">
                                yayoi991331@gmail.com
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Main App
        function MiniCactpotSolver() {
            const [lang, setLang] = useState(() => {
                try {
                    const saved = localStorage.getItem('cactpot_lang');
                    if (saved) return saved;
                    const browserLang = navigator.language || navigator.userLanguage; 
                    const code = browserLang.toLowerCase();
                    if (code.startsWith('ja')) return 'ja';
                    if (code.startsWith('de')) return 'de';
                    if (code.startsWith('fr')) return 'fr';
                    if (code.startsWith('ko')) return 'ko';
                    if (code.startsWith('zh-cn') || code.startsWith('zh-sg')) return 'cn';
                    if (code.startsWith('en')) return 'en';
                    return 'zh';
                } catch(e) { return 'zh'; }
            });

            // ‚òÖ‚òÖ‚òÖ Ê†∏ÂøÉ‰øÆÊîπÔºöÂãïÊÖãÂàáÊèõÂ≠óÂûãÔºåËß£Ê±∫Á∞°È´î‰∏≠ÊñáÈ°ØÁ§∫‰∏ç‰∏ÄËá¥ÁöÑÂïèÈ°å ‚òÖ‚òÖ‚òÖ
            useEffect(() => { 
                try { 
                    localStorage.setItem('cactpot_lang', lang); 
                } catch(e) {} 
                
                const currentTitle = LOCALE[lang]['app_title']; 
                document.title = currentTitle; 
                const metaTitle = document.querySelector('meta[name="apple-mobile-web-app-title"]'); 
                if (metaTitle) metaTitle.setAttribute('content', currentTitle); 

                // ÂãïÊÖãË®≠ÂÆö HTML lang Â±¨ÊÄßËàáÂ≠óÈ´î
                document.documentElement.lang = lang === 'cn' ? 'zh-CN' : (lang === 'zh' ? 'zh-TW' : lang);
                
                if (lang === 'cn') {
                    // Á∞°È´î‰∏≠ÊñáÊ®°ÂºèÔºöÂÑ™ÂÖà‰ΩøÁî®ÂæÆËªüÈõÖÈªë„ÄÅËòãÊñπ
                    document.body.style.fontFamily = '"Segoe UI", "Microsoft YaHei", "PingFang SC", sans-serif';
                } else {
                    // È†êË®≠Ê®°Âºè (ÁπÅÈ´î‰∏≠ÊñáÁ≠â)ÔºöÂÑ™ÂÖà‰ΩøÁî®ÂæÆËªüÊ≠£ÈªëÈ´î
                    document.body.style.fontFamily = '"Segoe UI", "Microsoft JhengHei", sans-serif';
                }
            }, [lang]);

            const [board, setBoard] = useState(Array(9).fill(null));
            const [openSelectorIndex, setOpenSelectorIndex] = useState(null);
            const [isFullFillMode, setIsFullFillMode] = useState(false);
            const [showPayouts, setShowPayouts] = useState(false);
            const [showLangMenu, setShowLangMenu] = useState(false);
            const [showInstallModal, setShowInstallModal] = useState(false);
            const [showAboutModal, setShowAboutModal] = useState(false); 
            
            const [isSoundOn, setIsSoundOn] = useState(() => { try { const saved = localStorage.getItem('cactpot_sound'); return saved === null ? true : saved === 'true'; } catch(e) { return true; } });
            
            const sounds = useSound(isSoundOn);

            const toggleSound = () => { 
                setIsSoundOn(prev => { 
                    const newState = !prev; 
                    try { localStorage.setItem('cactpot_sound', String(newState)); } catch(e) {} 
                    return newState; 
                }); 
            };

            const handleShare = async () => {
                sounds.click();
                if (navigator.share) {
                    try {
                        await navigator.share({
                            title: LOCALE[lang].title,
                            text: LOCALE[lang].description, 
                            url: window.location.href,
                        });
                    } catch (err) {}
                } else {
                    try {
                        await navigator.clipboard.writeText(window.location.href);
                        alert(LOCALE[lang].link_copied);
                    } catch (err) {}
                }
            };
            
            const [solutions, setSolutions] = useState([]);
            const [bestLineIndices, setBestLineIndices] = useState([]);
            const [suggestedCellIndices, setSuggestedCellIndices] = useState([]);

            const t = (key) => LOCALE[lang][key] || key;

            const getLineName = (index) => {
                if (index <= 2) return `${t('row')} ${index + 1}`;
                if (index <= 5) return `${t('col')} ${index - 2}`;
                if (index === 6) return `${t('diag')} 1`; 
                if (index === 7) return `${t('diag')} 2`;
                return "";
            };

            const filledCount = board.filter(n => n !== null).length;
            const isSelectionPhase = filledCount < 4 || isFullFillMode; 
            const showAnalysis = !isSelectionPhase || isFullFillMode;

            const availableNumbers = useMemo(() => {
                const used = new Set(board.filter((n) => n !== null));
                return [1, 2, 3, 4, 5, 6, 7, 8, 9].filter((n) => !used.has(n));
            }, [board]);
            const usedNumbersSet = useMemo(() => new Set(board.filter((n) => n !== null)), [board]);

            // ‚òÖ‚òÖ‚òÖ ÈáçÂØ´ÂæåÁöÑ useEffectÔºöÊï¥Âêà Golden Logic Ê†∏ÂøÉ ‚òÖ‚òÖ‚òÖ
            useEffect(() => {
                // 1. ËΩâÊèõ React Áõ§Èù¢ (null) ÁÇ∫Ê†∏ÂøÉÈÇèËºØÁõ§Èù¢ (0)
                const solverState = board.map(val => val === null ? 0 : val);
                const solverRevealedCount = solverState.filter(v => v > 0).length;

                // 2. Ê∫ñÂÇôÊï∏Êìö
                const emptyIndices = board.map((val, idx) => (val === null ? idx : -1)).filter((idx) => idx !== -1);
                const perms = getPermutations(availableNumbers);
                const lineStats = LINES.map(() => ({ totalMGP: 0, chance10k: 0, chance3600: 0, counts: 0, payoutDist: {} }));
                
                // 3. Âü∑Ë°åÊéíÂàóÁµÑÂêàË®àÁÆó (ÂÉÖÁÇ∫‰∫ÜÁîüÊàêÊ©üÁéáÂàÜ‰ΩàË°®ÔºåÂ¶Ç 10k: 30%)
                // Âõ†ÁÇ∫Êèê‰æõÁöÑ Core Code Ê≤íÊúâËøîÂõûÂàÜ‰ΩàÁ¥∞ÁØÄÔºåÊâÄ‰ª•ÂøÖÈ†à‰øùÁïôÈÄôÊÆµÈÇèËºØ‰ª•Á∂≠ÊåÅ UI ÂäüËÉΩ
                perms.forEach((perm) => {
                    const tempBoard = [...board];
                    perm.forEach((val, i) => tempBoard[emptyIndices[i]] = val);
                    LINES.forEach((lineIndices, lineId) => {
                        const sum = tempBoard[lineIndices[0]] + tempBoard[lineIndices[1]] + tempBoard[lineIndices[2]];
                        const payout = PAYOUTS[sum] || 0;
                        lineStats[lineId].totalMGP += payout; lineStats[lineId].counts++; lineStats[lineId].payoutDist[payout] = (lineStats[lineId].payoutDist[payout] || 0) + 1;
                        if (sum === 6) lineStats[lineId].chance10k++;
                        if (sum === 24) lineStats[lineId].chance3600++;
                    });
                });

                // 4. Âü∫Á§éÁµêÊûúÂ∞ÅË£ù
                const results = lineStats.map(stat => {
                    if (stat.counts === 0) return { ev: 0, chance10k: 0, chance3600: 0, allProbs: [] };
                    const allProbs = Object.entries(stat.payoutDist).map(([mgp, count]) => ({ mgp: parseInt(mgp), percent: (count / stat.counts) * 100 })).filter(p => p.percent > 0).sort((a, b) => b.mgp - a.mgp); 
                    return { 
                        ev: Math.floor(stat.totalMGP / stat.counts), // È†êË®≠‰ΩøÁî®ÈÅçÊ≠∑Âπ≥ÂùáÂÄº
                        chance10k: (stat.chance10k / stat.counts) * 100, 
                        chance3600: (stat.chance3600 / stat.counts) * 100, 
                        allProbs: allProbs 
                    };
                });

                // 5. „ÄêÊ†∏ÂøÉÊï¥Âêà„ÄëÔºö‰ΩøÁî® PerfectCactpot Ê±∫ÂÆö "ÊúÄ‰Ω≥Êé®Ëñ¶Ê†º (Suggestions)"
                let suggestions = [];
                if (solverRevealedCount < 4) {
                    // ‰ΩøÁî® PerfectCactpot.solve ÂèñÂæóÊé®Ëñ¶Èô£Âàó [bool, bool, ...]
                    const recs = PerfectCactpot.solve(solverState);
                    suggestions = recs.map((isRec, idx) => isRec ? idx : -1).filter(i => i !== -1);
                }
                
                // 6. „ÄêÊ†∏ÂøÉÊï¥Âêà„ÄëÔºöËã•Â∑≤Êè≠Á§∫ 4 Ê†ºÔºå‰ΩøÁî® Solver.solve Ë®àÁÆó "Á≤æÁ¢∫ÊúüÊúõÂÄº (EV)" ‰∏¶Ë¶ÜËìãÂéüÊúâÁµêÊûú
                // ÈÄôÊ®£Á¢∫‰øùÊï∏ÂÄºËàáÊ†∏ÂøÉÈÇèËºØ 100% ‰∏ÄËá¥
                if (solverRevealedCount === 4) {
                     const table = [[0,0,0],[0,0,0],[0,0,0]];
                     for(let i=0; i<9; i++) table[Math.floor(i/3)][i%3] = solverState[i];
                     
                     // ÂëºÂè´ Solver Ê†∏ÂøÉ
                     const exactEVs = Solver.solve(table, payout); 
                     
                     // Ë¶ÜËìã results ‰∏≠ÁöÑ ev
                     exactEVs.forEach((ev, idx) => {
                         if (results[idx]) results[idx].ev = ev;
                     });
                }

                setSolutions(results);
                
                // Ë®≠ÂÆöÊé®Ëñ¶Ê†ºÂ≠ê (ÂÆåÂÖ®‰æùË≥¥Ê†∏ÂøÉ)
                // ‰øÆÊîπË™™ÊòéÔºöÁï∂ filledCount === 0 ÊôÇÔºå‰∏çÈ°ØÁ§∫Êé®Ëñ¶ÔºåÂõ†ÁÇ∫ÈÅäÊà≤‰∏ÄÈñãÂßãÊòØÈö®Ê©üÁµ¶‰∏ÄÂÄãÊï∏Â≠óÔºåÁé©ÂÆ∂ÁÑ°Ê≥ïÈÅ∏Êìá„ÄÇ
                if (filledCount < 4 && filledCount > 0) {
                     setSuggestedCellIndices(suggestions);
                } else {
                     setSuggestedCellIndices([]);
                }

                const maxEV = Math.max(...results.map(r => r.ev));
                setBestLineIndices(results.map((r, i) => r.ev === maxEV ? i : -1).filter(i => i !== -1));

            }, [board, availableNumbers, filledCount, isFullFillMode]);

            const handleSelect = (val) => {
                const newBoard = [...board];
                if (val !== null) { const existingIdx = newBoard.indexOf(val); if (existingIdx !== -1) newBoard[existingIdx] = null; }
                if (openSelectorIndex !== null) { newBoard[openSelectorIndex] = val; const newFilledCount = newBoard.filter(n => n !== null).length; if (newFilledCount === 4 && filledCount < 4) { sounds.cash(); } }
                setBoard(newBoard); setOpenSelectorIndex(null);
            };
            const handleReset = () => { setBoard(Array(9).fill(null)); setOpenSelectorIndex(null); sounds.reset(); };
            const handleForceUpdate = () => { if(confirm("Á¢∫ÂÆöË¶ÅÈáçÊñ∞Êï¥ÁêÜÁ∂≤È†ÅÂóéÔºü")) { window.location.reload(true); } }

            const Indicator = ({ lineId }) => {
                const ArrowIcon = getArrowIcon(lineId);
                if (!solutions[lineId]) return <div className="w-12 h-12"></div>;
                const { ev, chance10k, chance3600 } = solutions[lineId];
                const isBest = showAnalysis && bestLineIndices.includes(lineId);
                const displayEv = ev >= 1000 ? (ev/1000).toFixed(1).replace('.0','') + 'k' : Math.floor(ev);
                let bestInfo = null;
                if (isBest) {
                    if (chance10k > 0) bestInfo = (<div className="flex flex-col items-center"><span className="text-[9px] text-yellow-200 leading-none">{t('label_10k')}</span><span className="text-[10px] font-bold text-white leading-none">{Math.round(chance10k)}%</span></div>);
                    else if (chance3600 > 0) bestInfo = (<div className="flex flex-col items-center"><span className="text-[9px] text-fuchsia-200 leading-none">{t('label_3600')}</span><span className="text-[10px] font-bold text-white leading-none">{Math.round(chance3600)}%</span></div>);
                }
                return (
                    <div className={`relative flex flex-col items-center justify-center transition-all duration-300 shadow-md border-2 ${isBest ? 'w-14 h-14 rounded-2xl bg-gradient-to-b from-green-600 to-green-900 border-green-400 text-white shadow-[0_0_20px_rgba(0,255,0,0.6)] z-20 scale-110' : 'w-12 h-12 rounded-full bg-black/60 border-[#d4af37]/30 text-[#d4af37]/70'}`}>
                        {isBest ? (bestInfo ? bestInfo : <span className="text-xs font-bold leading-none">{displayEv}</span>) : (<span className="text-[10px] font-bold leading-none">{displayEv}</span>)}
                        <div className={`text-sm mt-0.5 ${isBest ? 'text-white animate-pulse drop-shadow' : ''}`}>{ArrowIcon}</div>
                    </div>
                );
            };

            const GameCell = ({ idx }) => {
                const cellValue = board[idx];
                const isSuggested = isSelectionPhase && suggestedCellIndices.includes(idx);
                const isLocked = !isFullFillMode && (cellValue === null && filledCount >= 4);
                return (
                    <button disabled={isLocked} onClick={() => { if (!isLocked) { setOpenSelectorIndex(idx); if (isSuggested && !cellValue) sounds.reveal(); else sounds.click(); } }} className={`circle-cell w-16 h-16 md:w-20 md:h-20 flex flex-col items-center justify-center text-3xl md:text-5xl font-bold transition-all duration-200 group ${cellValue !== null ? 'filled' : ''} ${isLocked ? 'opacity-40 cursor-not-allowed bg-black/40 border-[#4a0404]' : 'hover:scale-105 hover:border-[#fcd34d] active:scale-95'} ${isSuggested && !cellValue ? 'suggested' : ''}`}>
                        {!cellValue && !isLocked && (<div className="absolute inset-0 opacity-20 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDIwIDIwIj48Y2lyY2xlIGN4PSIxMCIgY3k9IjEwIiByPSIxIiBmaWxsPSIjZDRhZjM3Ii8+PC9zdmc+')] bg-center"></div>)}
                        {cellValue ? (<span className="drop-shadow-[0_2px_2px_rgba(0,0,0,0.8)] font-game">{cellValue}</span>) : (!isLocked && <Sparkles className={`w-5 h-5 md:w-6 md:h-6 ${isSuggested ? 'text-white animate-pulse' : 'text-[#d4af37]/30'}`} />)}
                        {isSuggested && !cellValue && (<div className="absolute inset-0 flex items-center justify-center pointer-events-none"><div className="bg-gradient-to-r from-purple-600 via-pink-600 to-blue-600 text-white text-[9px] md:text-[10px] font-bold px-1.5 py-0.5 rounded-full shadow-[0_0_10px_rgba(255,255,255,0.5)] animate-bounce border border-white/50 tracking-wider">{t('reveal')}</div></div>)}
                    </button>
                );
            }

            const AnalysisList = () => {
                if (!showAnalysis || solutions.length === 0) return null;
                const rankedSolutions = solutions.map((sol, index) => ({ ...sol, originalIndex: index })).sort((a, b) => b.ev - a.ev);
                const [expandedLine, setExpandedLine] = useState(null);
                const toggleExpand = (idx) => { sounds.click(); setExpandedLine(expandedLine === idx ? null : idx); };
                return (
                    <div className="w-full max-w-[400px] mt-8 animate-in slide-in-from-bottom-4 fade-in duration-500">
                        <div className="flex items-center gap-2 mb-3 px-2"><h3 className="text-gold font-bold text-base tracking-wider uppercase drop-shadow-sm">{t('analysis_title')}</h3></div>
                        <div className="casino-panel rounded-2xl overflow-hidden divide-y divide-[#d4af37]/20">
                            {rankedSolutions.map((sol, rank) => {
                                const isBest = bestLineIndices.includes(sol.originalIndex);
                                const name = getLineName(sol.originalIndex);
                                const ArrowIcon = getArrowIcon(sol.originalIndex);
                                const isExpanded = expandedLine === sol.originalIndex;
                                const notablePrizes = sol.allProbs.filter(p => p.mgp >= 720).sort((a, b) => b.mgp - a.mgp);
                                const displayPrizes = isBest ? notablePrizes.slice(0, 1) : notablePrizes;
                                const bestPickCenter = isBest ? (<div className="flex-1 flex items-center justify-center animate-pulse mx-2"><span className="text-[#fcd34d] text-sm font-bold tracking-wider whitespace-nowrap drop-shadow-md border-b border-[#fcd34d]/50 pb-0.5">{t('tap_view')}</span></div>) : null;
                                return (
                                    <div key={sol.originalIndex} className="flex flex-col">
                                        <button onClick={() => toggleExpand(sol.originalIndex)} className={`w-full flex items-center justify-between transition-all text-left border-l-4 group relative overflow-hidden ${isBest ? 'py-4 px-3 bg-gradient-to-r from-green-900/60 to-transparent border-green-500 shadow-[inset_0_0_20px_rgba(0,128,0,0.1)] h-24' : 'py-3 px-3 hover:bg-white/5 border-transparent'} ${isExpanded ? 'bg-black/40' : ''}`}>
                                            <div className="flex items-center gap-3 shrink-0">
                                                <div className={`w-8 h-8 flex items-center justify-center rounded-full font-bold text-sm shadow-inner border ${isBest ? 'bg-green-700 border-green-400 text-white shadow-[0_0_10px_rgba(0,255,0,0.3)]' : 'bg-black/40 border-[#d4af37]/20 text-[#d4af37]/60'}`}>{ArrowIcon}</div>
                                                <div className="flex flex-col"><span className={`text-sm font-bold ${isBest ? 'text-green-400 drop-shadow' : 'text-zinc-300'}`}>{name}</span><span className="text-[10px] text-[#d4af37]/60 uppercase tracking-wider">{isBest ? t('best_pick') : `${t('rank')} #${rank+1}`}</span></div>
                                            </div>
                                            {bestPickCenter}
                                            <div className="flex flex-col items-end justify-center gap-1 shrink-0 h-full">
                                                <span className={`font-bold font-mono ${isBest ? 'text-xl text-gold drop-shadow-md mb-1' : 'text-base text-zinc-300'}`}>${Math.floor(sol.ev).toLocaleString()}</span>
                                                <div className="flex flex-wrap justify-end gap-1.5 min-h-[20px]">
                                                    {displayPrizes.length > 0 ? (displayPrizes.map(p => { const badgeStyle = getPrizeStyle(p.mgp); const textSize = p.mgp >= 10000 ? "text-xs" : "text-[10px]"; const label = p.mgp >= 1000 ? (p.mgp === 10000 ? '10k' : (p.mgp/1000).toString() + 'k') : p.mgp; return (<span key={p.mgp} className={`${textSize} px-1.5 py-0.5 rounded border ${badgeStyle} backdrop-blur-sm flex items-center`}>{label}<span className="opacity-70 text-[9px] ml-0.5">:{p.percent.toFixed(0)}%</span></span>) })) : null}
                                                </div>
                                            </div>
                                        </button>
                                        {isExpanded && (<div className="bg-black/40 p-3 shadow-inner border-t border-[#d4af37]/20 animate-in slide-in-from-top-2 duration-200"><div className="grid grid-cols-3 gap-2">{sol.allProbs.map((prob) => { const badgeStyle = getPrizeStyle(prob.mgp); return (<div key={prob.mgp} className={`flex flex-col items-center justify-center p-2 rounded-lg border shadow-sm ${badgeStyle} bg-opacity-20`}><span className="text-xs font-bold">{prob.mgp.toLocaleString()}</span><span className="text-[10px] font-mono opacity-80">{prob.percent.toFixed(0)}%</span></div>) })}</div></div>)}
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-start pt-5 pb-20 px-4 relative">
                
                <AutoUpdateCheck />

                <div className="w-full max-w-md flex justify-between items-center mb-4 px-2 z-40 relative">
                    <div className="flex gap-2">
                        <button 
                            onClick={() => { toggleSound(); setTimeout(() => sounds.toggle(), 0); }}
                            className="flex items-center justify-center w-10 h-10 bg-black/40 backdrop-blur-md border border-[#d4af37]/30 rounded-full shadow-md text-[#d4af37]/60 hover:text-white transition-all active:scale-95"
                        >
                            {isSoundOn ? <Volume2 className="w-5 h-5 text-[#d4af37]" /> : <VolumeX className="w-5 h-5 text-zinc-500" />}
                        </button>

                        <button 
                             onClick={handleShare}
                             className="flex items-center justify-center w-10 h-10 bg-black/40 backdrop-blur-md border border-[#d4af37]/30 rounded-full shadow-md text-[#d4af37] hover:bg-[#d4af37]/10 transition-all active:scale-95"
                        >
                             <ShareIcon className="w-4 h-4" />
                        </button>
                    </div>

                    <div className="flex gap-2">
                        <button 
                             onClick={() => { setShowInstallModal(true); sounds.click(); }}
                             className="flex items-center justify-center gap-1.5 px-3 h-9 bg-black/40 backdrop-blur-md border border-[#d4af37]/30 rounded-full shadow-md text-[#d4af37] hover:bg-[#d4af37]/10 transition-all active:scale-95"
                        >
                             <Download className="w-3 h-3" />
                             <span className="text-[10px] font-bold uppercase whitespace-nowrap">{t('install_btn')}</span>
                        </button>

                        <button 
                             onClick={() => { setShowLangMenu(true); setTimeout(() => sounds.click(), 0); }}
                             className="flex items-center justify-center gap-1.5 px-3 h-9 bg-black/40 backdrop-blur-md border border-[#d4af37]/30 rounded-full shadow-md text-[#d4af37] hover:bg-[#d4af37]/10 transition-all active:scale-95"
                        >
                             <Globe className="w-3 h-3" />
                             <span className="text-[10px] font-bold uppercase whitespace-nowrap">{lang.toUpperCase()}</span>
                        </button>
                    </div>
                </div>

                <div className="w-full max-w-md mb-4 text-center relative shrink-0">
                    <div className="absolute top-0 left-1/2 -translate-x-1/2 w-64 h-32 bg-red-600/30 blur-[80px] rounded-full pointer-events-none mix-blend-screen"></div>
                    <div className="relative flex flex-col items-center gap-2">
                        <Trophy className="w-8 h-8 text-[#d4af37] drop-shadow-[0_0_10px_rgba(212,175,55,0.8)]" />
                        <h1 className="text-gold text-3xl md:text-5xl font-game font-extrabold tracking-widest drop-shadow-[0_5px_5px_rgba(0,0,0,0.8)] leading-tight py-1 relative z-10">
                            {t('title')}
                        </h1>
                        <div className="flex items-center gap-2 opacity-80">
                            <div className="h-[2px] w-16 bg-gradient-to-r from-transparent to-[#d4af37]"></div>
                            <div className="w-2 h-2 rotated-45 bg-[#d4af37] transform rotate-45"></div>
                            <div className="h-[2px] w-16 bg-gradient-to-l from-transparent to-[#d4af37]"></div>
                        </div>
                    </div>
                </div>

                <div className="mb-6 flex flex-col w-full max-w-[340px] gap-4 shrink-0 relative z-20">
                    <div className="flex gap-3">
                        <button onClick={handleReset} className="flex-1 py-4 btn-3d bg-gradient-to-b from-[#7f1d1d] to-[#4a0404] border-2 border-[#991b1b] rounded-2xl text-red-100 font-bold tracking-wider flex items-center justify-center gap-2 shadow-lg group"><RefreshCw className="w-5 h-5 group-hover:rotate-180 transition-transform duration-500" /> {t('reset')}</button>
                        <button onClick={() => { setShowPayouts(true); setTimeout(() => sounds.click(), 0); }} className="flex-1 py-4 btn-3d bg-gradient-to-b from-[#fcd34d] to-[#b45309] border-2 border-[#fcd34d] rounded-2xl text-[#451a03] font-bold tracking-wider flex items-center justify-center gap-2 shadow-lg group"><BookOpen className="w-5 h-5 group-hover:scale-110 transition-transform" /> {t('payout_btn')}</button>
                    </div>
                </div>

                <div className="w-full max-w-[420px] casino-panel rounded-[40px] p-6 flex flex-col justify-center shrink-0 shadow-[0_20px_50px_rgba(0,0,0,0.8)]">
                    <div className="grid grid-cols-[3rem_1fr_1fr_1fr_3rem] gap-2 items-center justify-items-center w-full">
                        <Indicator lineId={6} /> <Indicator lineId={3} /> <Indicator lineId={4} /> <Indicator lineId={5} /> <Indicator lineId={7} /> 
                        <Indicator lineId={0} /> <GameCell idx={0} /> <GameCell idx={1} /> <GameCell idx={2} /> <div />
                        <Indicator lineId={1} /> <GameCell idx={3} /> <GameCell idx={4} /> <GameCell idx={5} /> <div />
                        <Indicator lineId={2} /> <GameCell idx={6} /> <GameCell idx={7} /> <GameCell idx={8} /> <div />
                    </div>
                </div>

                <div className="w-full max-w-[340px] mt-6 flex justify-center">
                    <button onClick={() => { setIsFullFillMode(!isFullFillMode); setTimeout(() => sounds.toggle(), 0); }} className={`px-6 py-2 rounded-full text-xs font-bold tracking-widest uppercase transition-all border ${isFullFillMode ? 'bg-blue-900/50 border-blue-400 text-blue-200 shadow-[0_0_10px_rgba(59,130,246,0.5)]' : 'bg-transparent border-[#d4af37]/30 text-[#d4af37]/50 hover:bg-[#d4af37]/10 hover:text-[#d4af37]'}`}>
                        {isFullFillMode ? <span className="flex items-center gap-2"><Unlock className="w-3 h-3"/> {t('mode_on')}</span> : <span className="flex items-center gap-2"><Lock className="w-3 h-3"/> {t('mode_off')}</span>}
                    </button>
                </div>
                
                <AnalysisList />

                <div className="mt-12 flex flex-col items-center gap-4 pb-12 opacity-80 transition-opacity">
                    <button onClick={() => { setShowAboutModal(true); sounds.click(); }} className="flex items-center gap-1.5 px-4 py-1.5 rounded-full border border-[#d4af37]/30 bg-black/20 text-[#d4af37] text-xs font-bold hover:bg-[#d4af37]/10 transition-all">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        {t('about_btn')}
                    </button>

                    <div className="flex flex-col items-center gap-1">
                        <div className="text-[#d4af37] text-[10px] font-mono opacity-60">{t('ver_prefix')} {BUILD_TIMESTAMP} ({t('region')})</div>
                        <div className="text-[#d4af37]/30 text-[10px] scale-90 select-none cursor-default">
                            {lang === 'zh' || lang === 'cn' ? 'Êú¨Á´ôÂÉÖ‰ΩøÁî® GA ÈÄ≤Ë°åÂåøÂêçÊµÅÈáèÁµ±Ë®àÔºå‰∏çËíêÈõÜÂÄã‰∫∫ÂÄãË≥á' : 'Anonymous usage data is collected via Google Analytics.'}
                        </div>
                    </div>
                    
                    <button onClick={handleForceUpdate} className="text-[10px] text-[#d4af37]/50 underline flex items-center gap-1 hover:text-[#d4af37]"><RotateCcw className="w-3 h-3" /> {t('force_update')}</button>
                </div>

                <NumberSelector isOpen={openSelectorIndex !== null} currentValue={openSelectorIndex !== null ? board[openSelectorIndex] : null} usedNumbers={usedNumbersSet} onSelect={handleSelect} onClose={() => setOpenSelectorIndex(null)} t={t} playSound={val => val === 'select' ? null : (val === 'clear' ? null : sounds.click())} />
                
                <PayoutTableModal isOpen={showPayouts} onClose={() => setShowPayouts(false)} t={t} playSound={sounds.click} />
                
                <LanguageModal isOpen={showLangMenu} onClose={() => setShowLangMenu(false)} currentLang={lang} setLang={setLang} t={t} playSound={sounds.click} />
                
                <InstallModal isOpen={showInstallModal} onClose={() => setShowInstallModal(false)} t={t} playSound={sounds.click} />
                
                <AboutModal isOpen={showAboutModal} onClose={() => setShowAboutModal(false)} t={t} playSound={sounds.click} />
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MiniCactpotSolver />);
    </script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful:', registration.scope);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed:', err);
                    });
            });
        }
    </script>
</body>
</html>